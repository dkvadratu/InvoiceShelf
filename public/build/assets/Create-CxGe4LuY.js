import{aa as ce,F as pe,ag as me,G as xe,v as ge,H as _e,e as F,j as E,i as ye,N as fe,aF as ve,c as Ee,a as r,w as l,Q as be,r as d,n as $e,f as c,aj as he,$ as Ce,g as $,ah as w,aI as D,o as g,b as U,m as Be,K as y,L as C,l as e,q as M,t as q,M as R,aJ as P}from"./main-BfksJgUh.js";import{u as Ve}from"./expense-CnCWwkCi.js";import{u as we}from"./category-BLC848bF.js";import{_ as Me}from"./CreateCustomFields-DTwiGqAq.js";import{_ as qe}from"./CategoryModal-vBgwM4tW.js";import{_ as Ie}from"./ExchangeRateConverter-DQqyUqPH.js";import"./dynamic-import-helper-BheWnx7M.js";import"./exchange-rate-Bp5qB9T2.js";const Se={class:"hidden md:block"},ke={class:"block md:hidden"},O="newExpense",Te={__name:"Create",setup(Fe){const f=ce(),N=pe(),t=Ve(),v=we(),H=me(),z=xe(),b=fe(),J=$e(),{t:i}=ge.useI18n(),j=_e();let _=F(!1),u=F(!1);const I=F(!1),K=E(()=>({currentExpense:{expense_category_id:{required:c.withMessage(i("validation.required"),$)},expense_date:{required:c.withMessage(i("validation.required"),$)},amount:{required:c.withMessage(i("validation.required"),$),minValue:c.withMessage(i("validation.price_minvalue"),D(.1)),maxLength:c.withMessage(i("validation.price_maxlength"),w(20))},base_tax:{minValue:c.withMessage(i("validation.price_minvalue"),D(0)),maxLength:c.withMessage(i("validation.price_maxlength"),w(20))},base_total:{required:c.withMessage(i("validation.required"),$),minValue:c.withMessage(i("validation.price_minvalue"),D(.1)),maxLength:c.withMessage(i("validation.price_maxlength"),w(20))},notes:{maxLength:c.withMessage(i("validation.description_maxlength"),w(65e3))},currency_id:{required:c.withMessage(i("validation.required"),$)},exchange_rate:{required:he(function(){return c.withMessage(i("validation.required"),$),t.showExchangeRate}),decimal:c.withMessage(i("validation.valid_exchange_rate"),Ce)}}})),o=ye(K,t,{$scope:O}),A=E({get:()=>t.currentExpense.amount/100,set:a=>{t.currentExpense.amount=Math.round(a*100)}}),L=E({get:()=>t.currentExpense.base_tax/100,set:a=>{t.currentExpense.base_tax=Math.round(a*100),t.currentExpense.base_total=Math.round(t.currentExpense.amount+t.currentExpense.base_tax)}}),T=E({get:()=>t.currentExpense.base_total/100,set:a=>{t.currentExpense.base_total=Math.round(a*100)}}),p=E(()=>b.name==="expenses.edit"),G=E(()=>p.value?i("expenses.edit_expense"):i("expenses.new_expense")),Q=E(()=>p.value?`/reports/expenses/${b.params.id}/download-receipt`:"");t.resetCurrentExpenseData(),H.resetCustomFields(),ne();function W(a,n){t.currentExpense.attachment_receipt=n}function X(){t.currentExpense.attachment_receipt=null,I.value=!0}function Y(){z.openModal({title:i("settings.expense_category.add_category"),componentName:"CategoryModal",size:"sm"})}function Z(a){t.currentExpense.selectedCurrency=j.currencies.find(n=>n.id===a)}async function ee(a){let n=await v.fetchCategories({search:a});if(n.data.data.length>0&&v.editCategory&&!n.data.data.find(x=>x.id==v.editCategory.id)){let x=Object.assign({},v.editCategory);n.data.data.unshift(x)}return n.data.data}async function te(a){let n=await f.fetchCustomers({search:a});if(n.data.data.length>0&&f.editCustomer&&!n.data.data.find(x=>x.id==f.editCustomer.id)){let x=Object.assign({},f.editCustomer);n.data.data.unshift(x)}return n.data.data}async function ne(){if(p.value||(t.currentExpense.currency_id=N.selectedCompanyCurrency.id,t.currentExpense.selectedCurrency=N.selectedCompanyCurrency),u.value=!0,await t.fetchPaymentModes({limit:"all"}),p.value){const a=await t.fetchExpense(b.params.id);t.currentExpense.currency_id=t.currentExpense.selectedCurrency.id,a.data&&(!v.editCategory&&a.data.data.expense_category&&(v.editCategory=a.data.data.expense_category),!f.editCustomer&&a.data.data.customer&&(f.editCustomer=a.data.data.customer))}else b.query.customer&&(t.currentExpense.customer_id=b.query.customer);u.value=!1}async function ae(){if(o.value.$touch(),o.value.$invalid)return;_.value=!0;let a=t.currentExpense;try{p.value?await t.updateExpense({id:b.params.id,data:a,isAttachmentReceiptRemoved:I.value}):await t.addExpense(a),_.value=!1,t.currentExpense.attachment_receipt=null,I.value=!1,J.push("/admin/expenses")}catch(n){console.error(n),_.value=!1;return}}return ve(()=>{t.resetCurrentExpenseData(),f.editCustomer=null,v.editCategory=null}),(a,n)=>{const h=d("BaseBreadcrumbItem"),x=d("BaseBreadcrumb"),B=d("BaseIcon"),S=d("BaseButton"),re=d("BasePageHeader"),se=d("BaseSelectAction"),V=d("BaseMultiselect"),m=d("BaseInputGroup"),oe=d("BaseDatePicker"),k=d("BaseMoney"),le=d("BaseTextarea"),ue=d("BaseFileUploader"),ie=d("BaseCard"),de=d("BasePage");return g(),Ee(be,null,[r(qe),r(de,{class:"relative"},{default:l(()=>[U("form",{action:"",onSubmit:Be(ae,["prevent"])},[r(re,{title:G.value,class:"mb-5"},{actions:l(()=>[p.value&&e(t).currentExpense.attachment_receipt_url?(g(),y(S,{key:0,href:Q.value,tag:"a",variant:"primary-outline",type:"button",class:"mr-2"},{left:l(s=>[r(B,{name:"DownloadIcon",class:R(s.class)},null,8,["class"])]),default:l(()=>[M(" "+q(a.$t("expenses.download_receipt")),1)]),_:1},8,["href"])):C("",!0),U("div",Se,[r(S,{loading:e(_),"content-loading":e(u),disabled:e(_),variant:"primary",type:"submit"},{left:l(s=>[e(_)?C("",!0):(g(),y(B,{key:0,name:"ArrowDownOnSquareIcon",class:R(s.class)},null,8,["class"]))]),default:l(()=>[M(" "+q(p.value?a.$t("expenses.update_expense"):a.$t("expenses.save_expense")),1)]),_:1},8,["loading","content-loading","disabled"])])]),default:l(()=>[r(x,null,{default:l(()=>[r(h,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(h,{title:a.$t("expenses.expense",2),to:"/admin/expenses"},null,8,["title"]),r(h,{title:G.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(ie,null,{default:l(()=>[r(P,null,{default:l(()=>[r(m,{label:a.$t("expenses.category"),error:e(o).currentExpense.expense_category_id.$error&&e(o).currentExpense.expense_category_id.$errors[0].$message,"content-loading":e(u),required:""},{default:l(()=>[e(u)?C("",!0):(g(),y(V,{key:0,modelValue:e(t).currentExpense.expense_category_id,"onUpdate:modelValue":n[0]||(n[0]=s=>e(t).currentExpense.expense_category_id=s),"content-loading":e(u),"value-prop":"id",label:"name","track-by":"id",options:ee,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",invalid:e(o).currentExpense.expense_category_id.$error,placeholder:a.$t("expenses.categories.select_a_category"),onInput:n[1]||(n[1]=s=>e(o).currentExpense.expense_category_id.$touch())},{action:l(()=>[r(se,{onClick:Y},{default:l(()=>[r(B,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),M(" "+q(a.$t("settings.expense_category.add_new_category")),1)]),_:1})]),_:1},8,["modelValue","content-loading","invalid","placeholder"]))]),_:1},8,["label","error","content-loading"]),r(m,{label:a.$t("expenses.expense_date"),error:e(o).currentExpense.expense_date.$error&&e(o).currentExpense.expense_date.$errors[0].$message,"content-loading":e(u),required:""},{default:l(()=>[r(oe,{modelValue:e(t).currentExpense.expense_date,"onUpdate:modelValue":n[2]||(n[2]=s=>e(t).currentExpense.expense_date=s),"content-loading":e(u),"calendar-button":!0,invalid:e(o).currentExpense.expense_date.$error,onInput:n[3]||(n[3]=s=>e(o).currentExpense.expense_date.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","error","content-loading"]),r(m,{label:a.$t("expenses.amount"),error:e(o).currentExpense.amount.$error&&e(o).currentExpense.amount.$errors[0].$message,"content-loading":e(u),required:""},{default:l(()=>[(g(),y(k,{key:e(t).currentExpense.selectedCurrency,modelValue:A.value,"onUpdate:modelValue":n[4]||(n[4]=s=>A.value=s),class:"focus:border focus:border-solid focus:border-primary-500",invalid:e(o).currentExpense.amount.$error,currency:e(t).currentExpense.selectedCurrency,onInput:n[5]||(n[5]=s=>e(o).currentExpense.amount.$touch())},null,8,["modelValue","invalid","currency"]))]),_:1},8,["label","error","content-loading"]),r(P,null,{default:l(()=>[r(m,{label:a.$t("expenses.currency"),"content-loading":e(u),error:e(o).currentExpense.currency_id.$error&&e(o).currentExpense.currency_id.$errors[0].$message,required:""},{default:l(()=>[r(V,{modelValue:e(t).currentExpense.currency_id,"onUpdate:modelValue":[n[6]||(n[6]=s=>e(t).currentExpense.currency_id=s),Z],"value-prop":"id",label:"name","track-by":"name","content-loading":e(u),options:e(j).currencies,searchable:"","can-deselect":!1,placeholder:a.$t("customers.select_currency"),invalid:e(o).currentExpense.currency_id.$error,class:"w-full"},null,8,["modelValue","content-loading","options","placeholder","invalid"])]),_:1},8,["label","content-loading","error"]),r(Ie,{store:e(t),"store-prop":"currentExpense",v:e(o).currentExpense,"is-loading":e(u),"is-edit":p.value,"customer-currency":e(t).currentExpense.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1}),r(P,null,{default:l(()=>[r(m,{label:a.$t("expenses.base_tax"),error:e(o).currentExpense.base_tax.$error&&e(o).currentExpense.base_tax.$errors[0].$message,"content-loading":e(u)},{default:l(()=>[(g(),y(k,{key:e(t).currentExpense.selectedCurrency,modelValue:L.value,"onUpdate:modelValue":n[7]||(n[7]=s=>L.value=s),class:"focus:border focus:border-solid focus:border-primary-500",invalid:e(o).currentExpense.base_tax.$error,currency:e(t).currentExpense.selectedCurrency,onInput:n[8]||(n[8]=s=>e(o).currentExpense.base_tax.$touch())},null,8,["modelValue","invalid","currency"]))]),_:1},8,["label","error","content-loading"]),r(m,{label:a.$t("expenses.base_total"),error:e(o).currentExpense.base_total.$error&&e(o).currentExpense.base_total.$errors[0].$message,"content-loading":e(u),required:""},{default:l(()=>[(g(),y(k,{key:e(t).currentExpense.selectedCurrency,modelValue:T.value,"onUpdate:modelValue":n[9]||(n[9]=s=>T.value=s),class:"focus:border focus:border-solid focus:border-primary-500",invalid:e(o).currentExpense.base_total.$error,currency:e(t).currentExpense.selectedCurrency,onInput:n[10]||(n[10]=s=>e(o).currentExpense.base_total.$touch())},null,8,["modelValue","invalid","currency"]))]),_:1},8,["label","error","content-loading"])]),_:1}),r(m,{"content-loading":e(u),label:a.$t("expenses.customer")},{default:l(()=>[e(u)?C("",!0):(g(),y(V,{key:0,modelValue:e(t).currentExpense.customer_id,"onUpdate:modelValue":n[11]||(n[11]=s=>e(t).currentExpense.customer_id=s),"content-loading":e(u),"value-prop":"id",label:"name","track-by":"id",options:te,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",placeholder:a.$t("customers.select_a_customer")},null,8,["modelValue","content-loading","placeholder"]))]),_:1},8,["content-loading","label"]),r(m,{"content-loading":e(u),label:a.$t("payments.payment_mode")},{default:l(()=>[r(V,{modelValue:e(t).currentExpense.payment_method_id,"onUpdate:modelValue":n[12]||(n[12]=s=>e(t).currentExpense.payment_method_id=s),"content-loading":e(u),label:"name","value-prop":"id","track-by":"name",options:e(t).paymentModes,placeholder:a.$t("payments.select_payment_mode"),searchable:""},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r(m,{"content-loading":e(u),label:a.$t("expenses.note"),error:e(o).currentExpense.notes.$error&&e(o).currentExpense.notes.$errors[0].$message},{default:l(()=>[r(le,{modelValue:e(t).currentExpense.notes,"onUpdate:modelValue":n[13]||(n[13]=s=>e(t).currentExpense.notes=s),"content-loading":e(u),row:4,rows:"4",onInput:n[14]||(n[14]=s=>e(o).currentExpense.notes.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label","error"]),r(m,{label:a.$t("expenses.receipt")},{default:l(()=>[r(ue,{modelValue:e(t).currentExpense.receiptFiles,"onUpdate:modelValue":n[15]||(n[15]=s=>e(t).currentExpense.receiptFiles=s),accept:"image/*,.doc,.docx,.pdf,.csv,.xlsx,.xls",onChange:W,onRemove:X},null,8,["modelValue"])]),_:1},8,["label"]),r(Me,{"is-edit":p.value,class:"col-span-2","is-loading":e(u),type:"Expense",store:e(t),"store-prop":"currentExpense","custom-field-scope":O},null,8,["is-edit","is-loading","store"]),U("div",ke,[r(S,{loading:e(_),tabindex:6,variant:"primary",type:"submit",class:"flex justify-center w-full"},{left:l(s=>[e(_)?C("",!0):(g(),y(B,{key:0,name:"ArrowDownOnSquareIcon",class:R(s.class)},null,8,["class"]))]),default:l(()=>[M(" "+q(p.value?a.$t("expenses.update_expense"):a.$t("expenses.save_expense")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})],32)]),_:1})],64)}}};export{Te as default};
