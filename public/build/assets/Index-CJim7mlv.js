import{at as _e,a9 as pe,O as be,e as E,v as fe,I as ve,j as w,ab as Ee,ac as Be,K as _,w as s,r,n as ge,o as p,a,ae as C,L as F,q as b,t as f,M as h,af as I,l as i,V as v,b as B,a8 as ye,aR as he}from"./main-sWfemrx7.js";import{_ as Te}from"./ObservatoryIcon-BX3e7gWo.js";import{_ as ke}from"./EstimateIndexDropdown-Cg30_OY7.js";import{_ as Ce}from"./SendEstimateModal-crJdmU0i.js";import"./mail-driver-fNSQ4rv4.js";const Ie={class:"relative table-container"},Ae={class:"relative flex items-center justify-between h-10 mt-5 list-none border-b-2 border-gray-200 border-solid"},$e={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Se={class:"absolute items-center left-6 top-2.5 select-none"},Ve={class:"relative block"},xe={__name:"Index",setup(De){const u=_e(),W=pe(),T=be(),k=E(null),M=E(0),{t:l}=fe.useI18n(),g=E(!1),G=E([{label:l("estimates.draft"),value:"DRAFT"},{label:l("estimates.sent"),value:"SENT"},{label:l("estimates.viewed"),value:"VIEWED"},{label:l("estimates.expired"),value:"EXPIRED"},{label:l("estimates.accepted"),value:"ACCEPTED"},{label:l("estimates.rejected"),value:"REJECTED"}]),A=E(!0),c=E("general.draft");ge();let o=ve({customer_id:"",status:"",from_date:"",to_date:"",estimate_number:""});const P=w(()=>!u.totalEstimateCount&&!A.value),R=w({get:()=>u.selectedEstimates,set:t=>{u.selectEstimate(t)}}),L=w(()=>[{key:"checkbox",thClass:"extra w-10 pr-0",sortable:!1,tdClass:"font-medium text-gray-900 pr-0"},{key:"estimate_date",label:l("estimates.date"),thClass:"extra",tdClass:"font-medium text-gray-500"},{key:"estimate_number",label:l("estimates.number",2)},{key:"name",label:l("estimates.customer")},{key:"status",label:l("estimates.status")},{key:"total",label:l("estimates.total"),tdClass:"font-medium text-gray-900"},{key:"actions",tdClass:"text-right text-sm font-medium pl-0",thClass:"text-right pl-0",sortable:!1}]);Ee(o,()=>{z()},{debounce:500}),Be(()=>{u.selectAllField&&u.selectAllEstimates()});function O(){return T.hasAbilities([v.CREATE_ESTIMATE,v.EDIT_ESTIMATE,v.VIEW_ESTIMATE,v.SEND_ESTIMATE])}async function H(t,n){o.status="",$()}function $(){k.value&&k.value.refresh()}async function X({page:t,filter:n,sort:d}){let S={customer_id:o.customer_id,status:o.status,from_date:o.from_date,to_date:o.to_date,estimate_number:o.estimate_number,orderByField:d.fieldName||"created_at",orderBy:d.order||"desc",page:t};A.value=!0;let m=await u.fetchEstimates(S);return A.value=!1,{data:m.data.data,pagination:{totalPages:m.data.meta.last_page,currentPage:t,totalCount:m.data.meta.total,limit:10}}}function q(t){if(c.value==t.title)return!0;switch(c.value=t.title,t.title){case l("general.draft"):o.status="DRAFT";break;case l("general.sent"):o.status="SENT";break;default:o.status="";break}}function z(){u.$patch(t=>{t.selectedEstimates=[],t.selectAllField=!1}),M.value+=1,$()}function x(){o.customer_id="",o.status="",o.from_date="",o.to_date="",o.estimate_number="",c.value=l("general.all")}function J(){g.value&&x(),g.value=!g.value}async function K(){W.openDialog({title:l("general.are_you_sure"),message:l("estimates.confirm_delete"),yesLabel:l("general.ok"),noLabel:l("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(t=>{t&&u.deleteMultipleEstimates().then(n=>{$(),n.data&&u.$patch(d=>{d.selectedEstimates=[],d.selectAllField=!1})})})}function Q(t){switch(t){case"DRAFT":c.value=l("general.draft");break;case"SENT":c.value=l("general.sent");break;case"VIEWED":c.value=l("estimates.viewed");break;case"EXPIRED":c.value=l("estimates.expired");break;case"ACCEPTED":c.value=l("estimates.accepted");break;case"REJECTED":c.value=l("estimates.rejected");break;default:c.value=l("general.all");break}}return(t,n)=>{const d=r("BaseBreadcrumbItem"),S=r("BaseBreadcrumb"),m=r("BaseIcon"),V=r("BaseButton"),N=r("router-link"),Y=r("BasePageHeader"),Z=r("BaseCustomerSelectInput"),y=r("BaseInputGroup"),ee=r("BaseMultiselect"),U=r("BaseDatePicker"),te=r("BaseInput"),ae=r("BaseFilterWrapper"),se=r("BaseEmptyPlaceholder"),D=r("BaseTab"),le=r("BaseTabGroup"),oe=r("BaseDropdownItem"),ne=r("BaseDropdown"),j=r("BaseCheckbox"),re=r("BaseText"),ie=r("BaseEstimateStatusBadge"),ue=r("BaseFormatMoney"),me=r("BaseTable"),ce=r("BasePage");return p(),_(ce,null,{default:s(()=>[a(Ce),a(Y,{title:t.$t("estimates.title")},{actions:s(()=>[C(a(V,{variant:"primary-outline",onClick:J},{right:s(e=>[g.value?(p(),_(m,{key:1,name:"XMarkIcon",class:h(e.class)},null,8,["class"])):(p(),_(m,{key:0,class:h(e.class),name:"FunnelIcon"},null,8,["class"]))]),default:s(()=>[b(f(t.$t("general.filter"))+" ",1)]),_:1},512),[[I,i(u).totalEstimateCount]]),i(T).hasAbilities(i(v).CREATE_ESTIMATE)?(p(),_(N,{key:0,to:"estimates/create"},{default:s(()=>[a(V,{variant:"primary",class:"ml-4"},{left:s(e=>[a(m,{name:"PlusIcon",class:h(e.class)},null,8,["class"])]),default:s(()=>[b(" "+f(t.$t("estimates.new_estimate")),1)]),_:1})]),_:1})):F("",!0)]),default:s(()=>[a(S,null,{default:s(()=>[a(d,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),a(d,{title:t.$t("estimates.estimate",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),C(a(ae,{"row-on-xl":!0,onClear:x},{default:s(()=>[a(y,{label:t.$t("customers.customer",1)},{default:s(()=>[a(Z,{modelValue:i(o).customer_id,"onUpdate:modelValue":n[0]||(n[0]=e=>i(o).customer_id=e),placeholder:t.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:t.$t("estimates.status")},{default:s(()=>[a(ee,{modelValue:i(o).status,"onUpdate:modelValue":[n[1]||(n[1]=e=>i(o).status=e),Q],options:G.value,searchable:"",placeholder:t.$t("general.select_a_status"),onRemove:n[2]||(n[2]=e=>H())},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(y,{label:t.$t("general.from")},{default:s(()=>[a(U,{modelValue:i(o).from_date,"onUpdate:modelValue":n[3]||(n[3]=e=>i(o).from_date=e),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),n[9]||(n[9]=B("div",{class:"hidden w-8 h-0 mx-4 border border-gray-400 border-solid xl:block",style:{"margin-top":"1.5rem"}},null,-1)),a(y,{label:t.$t("general.to")},{default:s(()=>[a(U,{modelValue:i(o).to_date,"onUpdate:modelValue":n[4]||(n[4]=e=>i(o).to_date=e),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),a(y,{label:t.$t("estimates.estimate_number")},{default:s(()=>[a(te,{modelValue:i(o).estimate_number,"onUpdate:modelValue":n[5]||(n[5]=e=>i(o).estimate_number=e)},{left:s(e=>[a(m,{name:"HashtagIcon",class:h(e.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},512),[[I,g.value]]),C(a(se,{title:t.$t("estimates.no_estimates"),description:t.$t("estimates.list_of_estimates")},{actions:s(()=>[i(T).hasAbilities(i(v).CREATE_ESTIMATE)?(p(),_(V,{key:0,variant:"primary-outline",onClick:n[6]||(n[6]=e=>t.$router.push("/admin/estimates/create"))},{left:s(e=>[a(m,{name:"PlusIcon",class:h(e.class)},null,8,["class"])]),default:s(()=>[b(" "+f(t.$t("estimates.add_new_estimate")),1)]),_:1})):F("",!0)]),default:s(()=>[a(Te,{class:"mt-5 mb-4"})]),_:1},8,["title","description"]),[[I,P.value]]),C(B("div",Ie,[B("div",Ae,[a(le,{class:"-mb-5",onChange:q},{default:s(()=>[a(D,{title:t.$t("general.all"),filter:""},null,8,["title"]),a(D,{title:t.$t("general.draft"),filter:"DRAFT"},null,8,["title"]),a(D,{title:t.$t("general.sent"),filter:"SENT"},null,8,["title"])]),_:1}),i(u).selectedEstimates.length&&i(T).hasAbilities(i(v).DELETE_ESTIMATE)?(p(),_(ne,{key:0,class:"absolute float-right"},{activator:s(()=>[B("span",$e,[b(f(t.$t("general.actions"))+" ",1),a(m,{name:"ChevronDownIcon"})])]),default:s(()=>[a(oe,{onClick:K},{default:s(()=>[a(m,{name:"TrashIcon",class:"mr-3 text-gray-600"}),b(" "+f(t.$t("general.delete")),1)]),_:1})]),_:1})):F("",!0)]),(p(),_(me,{ref_key:"tableComponent",ref:k,data:X,columns:L.value,"placeholder-count":i(u).totalEstimateCount>=20?10:5,key:M.value,class:"mt-10"},ye({header:s(()=>[B("div",Se,[a(j,{modelValue:i(u).selectAllField,"onUpdate:modelValue":n[7]||(n[7]=e=>i(u).selectAllField=e),variant:"primary",onChange:i(u).selectAllEstimates},null,8,["modelValue","onChange"])])]),"cell-checkbox":s(({row:e})=>[B("div",Ve,[a(j,{id:e.id,modelValue:R.value,"onUpdate:modelValue":n[8]||(n[8]=de=>R.value=de),value:e.data.id},null,8,["id","modelValue","value"])])]),"cell-estimate_date":s(({row:e})=>[b(f(e.data.formatted_estimate_date),1)]),"cell-estimate_number":s(({row:e})=>[a(N,{to:{path:`estimates/${e.data.id}/view`},class:"font-medium text-primary-500"},{default:s(()=>[b(f(e.data.estimate_number),1)]),_:2},1032,["to"])]),"cell-name":s(({row:e})=>[a(re,{text:e.data.customer.name},null,8,["text"])]),"cell-status":s(({row:e})=>[a(ie,{status:e.data.status,class:"px-3 py-1"},{default:s(()=>[a(he,{status:e.data.status},null,8,["status"])]),_:2},1032,["status"])]),"cell-total":s(({row:e})=>[a(ue,{amount:e.data.total,currency:e.data.customer.currency},null,8,["amount","currency"])]),_:2},[O()?{name:"cell-actions",fn:s(({row:e})=>[a(ke,{row:e.data,table:k.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"]))],512),[[I,!P.value]])]),_:1})}}};export{xe as default};
