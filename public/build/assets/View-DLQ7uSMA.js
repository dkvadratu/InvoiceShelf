import{aa as M,N,v as O,e as P,I as L,S as ee,j as E,r as i,c as B,o as a,b as r,a as t,w as o,l as n,t as h,K as c,L as d,Q as G,R as q,M as X,q as V,a0 as te,F as se,a7 as K,P as ae,p as le,a9 as ne,O as oe,n as re,V as D}from"./main-h7MY4IwZ.js";import{L as ie}from"./LoadingIcon-J5wlxjAe.js";import{_ as ce}from"./LineChart-DvbITIry.js";import{_ as ue}from"./CustomerIndexDropdown-D8prB-u7.js";const de={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},me={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},pe={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},_e={class:"px-4 py-3 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},fe={class:"px-2"},ye={class:"px-2"},he={class:"flex-1 font-bold text-right whitespace-nowrap"},ge={key:0,class:"flex justify-center p-4 items-center"},ve={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},be={__name:"CustomerViewSidebar",setup(R){const w=M(),s=N(),{t:f}=O.useI18n();let y=P(!1),e=L({orderBy:null,orderByField:null,searchText:null});const p=P(null),x=P(1),_=P(1),I=P(null);v=ee.debounce(v,500);const S=E(()=>e.orderBy==="asc"||e.orderBy==null);E(()=>S.value?f("general.ascending"):f("general.descending"));function u(l){return s.params.id==l}async function $(l,g=!1){if(y.value)return;let k={};e.searchText!==""&&e.searchText!==null&&e.searchText!==void 0&&(k.display_name=e.searchText),e.orderBy!==null&&e.orderBy!==void 0&&(k.orderBy=e.orderBy),e.orderByField!==null&&e.orderByField!==void 0&&(k.orderByField=e.orderByField),y.value=!0;let A=await w.fetchCustomers({page:l,...k,limit:15});y.value=!1,p.value=p.value?p.value:[],p.value=[...p.value,...A.data.data],x.value=l||1,_.value=A.data.meta.last_page;let F=p.value.find(j=>j.id==s.params.id);g==!1&&!F&&x.value<_.value&&Object.keys(k).length===0&&$(++x.value),F&&setTimeout(()=>{g==!1&&C()},500)}function C(){const l=document.getElementById(`customer-${s.params.id}`);l&&(l.scrollIntoView({behavior:"smooth"}),l.classList.add("shake"),T())}function T(){I.value.addEventListener("scroll",l=>{l.target.scrollTop>0&&l.target.scrollTop+l.target.clientHeight>l.target.scrollHeight-200&&x.value<_.value&&$(++x.value,!0)})}async function v(){p.value=[],$()}function m(){return e.orderBy==="asc"?(e.orderBy="desc",v(),!0):(e.orderBy="asc",v(),!0)}return $(),(l,g)=>{var Y;const k=i("BaseIcon"),A=i("BaseInput"),F=i("BaseButton"),j=i("BaseRadio"),U=i("BaseInputGroup"),z=i("BaseDropdownItem"),Q=i("BaseDropdown"),H=i("BaseText"),J=i("BaseFormatMoney"),W=i("router-link");return a(),B("div",de,[r("div",me,[t(A,{modelValue:n(e).searchText,"onUpdate:modelValue":g[0]||(g[0]=b=>n(e).searchText=b),placeholder:l.$t("general.search"),"container-class":"mb-6",type:"text",variant:"gray",onInput:g[1]||(g[1]=b=>v())},{default:o(()=>[t(k,{name:"MagnifyingGlassIcon",class:"text-gray-500"})]),_:1},8,["modelValue","placeholder"]),r("div",pe,[t(Q,{"close-on-select":!1,position:"bottom-start","width-class":"w-40","position-class":"left-0"},{activator:o(()=>[t(F,{variant:"gray"},{default:o(()=>[t(k,{name:"FunnelIcon"})]),_:1})]),default:o(()=>[r("div",_e,h(l.$t("general.sort_by")),1),r("div",fe,[t(z,{class:"flex px-1 py-2 mt-1 cursor-pointer hover:rounded-md"},{default:o(()=>[t(U,{class:"pt-2 -mt-4"},{default:o(()=>[t(j,{id:"filter_create_date",modelValue:n(e).orderByField,"onUpdate:modelValue":[g[2]||(g[2]=b=>n(e).orderByField=b),v],label:l.$t("customers.create_date"),size:"sm",name:"filter",value:"invoices.created_at"},null,8,["modelValue","label"])]),_:1})]),_:1})]),r("div",ye,[t(z,{class:"flex px-1 cursor-pointer hover:rounded-md"},{default:o(()=>[t(U,{class:"pt-2 -mt-4"},{default:o(()=>[t(j,{id:"filter_display_name",modelValue:n(e).orderByField,"onUpdate:modelValue":[g[3]||(g[3]=b=>n(e).orderByField=b),v],label:l.$t("customers.display_name"),size:"sm",name:"filter",value:"name"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),t(F,{class:"ml-1",size:"md",variant:"gray",onClick:m},{default:o(()=>[S.value?(a(),c(k,{key:0,name:"SortAscendingIcon"})):(a(),c(k,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),r("div",{ref_key:"customerListSection",ref:I,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid sidebar base-scroll"},[(a(!0),B(G,null,q(p.value,(b,Z)=>(a(),B("div",{key:Z},[b?(a(),c(W,{key:0,id:"customer-"+b.id,to:`/admin/customers/${b.id}/view`,class:X(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":u(b.id)}]),style:{"border-top":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[r("div",null,[t(H,{text:b.name,class:"pr-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),b.contact_name?(a(),c(H,{key:0,text:b.contact_name,class:"mt-1 text-xs not-italic font-medium leading-5 text-gray-600"},null,8,["text"])):d("",!0)]),r("div",he,[t(J,{amount:b.due_amount!==null?b.due_amount:0,currency:b.currency},null,8,["amount","currency"])])]),_:2},1032,["id","to","class"])):d("",!0)]))),128)),n(y)?(a(),B("div",ge,[t(ie,{class:"h-6 m-1 animate-spin text-primary-400"})])):d("",!0),!((Y=p.value)!=null&&Y.length)&&!n(y)?(a(),B("p",ve,h(l.$t("customers.no_matching_customers")),1)):d("",!0)],512)])}}},xe={class:"pt-6 mt-5 border-t border-solid lg:pt-8 md:pt-4 border-gray-200"},Be={key:0,class:"text-sm font-bold leading-5 text-black non-italic"},$e={key:0},we={key:1},ke={key:1,class:"text-sm font-bold leading-5 text-black non-italic"},Ce={__name:"CustomerInfo",setup(R){const w=M(),s=E(()=>w.selectedViewCustomer),f=E(()=>w.isFetchingViewData),y=E(()=>{var e,p;return(e=s==null?void 0:s.value)!=null&&e.fields?(p=s==null?void 0:s.value)==null?void 0:p.fields:[]});return(e,p)=>{const x=i("BaseHeading"),_=i("BaseDescriptionListItem"),I=i("BaseDescriptionList"),S=i("BaseCustomerAddressDisplay");return a(),B("div",xe,[t(x,null,{default:o(()=>[V(h(e.$t("customers.basic_info")),1)]),_:1}),t(I,null,{default:o(()=>{var u,$,C;return[s.value.name?(a(),c(_,{key:0,"content-loading":f.value,label:e.$t("customers.display_name"),value:(u=s.value)==null?void 0:u.name},null,8,["content-loading","label","value"])):d("",!0),s.value.contact_name?(a(),c(_,{key:1,"content-loading":f.value,label:e.$t("customers.primary_contact_name"),value:($=s.value)==null?void 0:$.contact_name},null,8,["content-loading","label","value"])):d("",!0),s.value.email?(a(),c(_,{key:2,"content-loading":f.value,label:e.$t("customers.email"),value:(C=s.value)==null?void 0:C.email},null,8,["content-loading","label","value"])):d("",!0)]}),_:1}),t(I,{class:"mt-5"},{default:o(()=>{var u,$,C,T,v,m,l;return[t(_,{"content-loading":f.value,label:e.$t("wizard.currency"),value:(u=s.value)!=null&&u.currency?`${(C=($=s.value)==null?void 0:$.currency)==null?void 0:C.code} (${(v=(T=s.value)==null?void 0:T.currency)==null?void 0:v.symbol})`:""},null,8,["content-loading","label","value"]),s.value.phone?(a(),c(_,{key:0,"content-loading":f.value,label:e.$t("customers.phone_number"),value:(m=s.value)==null?void 0:m.phone},null,8,["content-loading","label","value"])):d("",!0),s.value.website?(a(),c(_,{key:1,"content-loading":f.value,label:e.$t("customers.website"),value:(l=s.value)==null?void 0:l.website},null,8,["content-loading","label","value"])):d("",!0)]}),_:1}),s.value.billing||s.value.shipping?(a(),c(x,{key:0,class:"mt-8"},{default:o(()=>[V(h(e.$t("customers.address")),1)]),_:1})):d("",!0),t(I,{class:"mt-5"},{default:o(()=>[s.value.billing?(a(),c(_,{key:0,"content-loading":f.value,label:e.$t("customers.billing_address")},{default:o(()=>[t(S,{address:s.value.billing},null,8,["address"])]),_:1},8,["content-loading","label"])):d("",!0),s.value.shipping?(a(),c(_,{key:1,"content-loading":f.value,label:e.$t("customers.shipping_address")},{default:o(()=>[t(S,{address:s.value.shipping},null,8,["address"])]),_:1},8,["content-loading","label"])):d("",!0)]),_:1}),y.value.length>0?(a(),c(x,{key:1,class:"mt-8"},{default:o(()=>[V(h(e.$t("settings.custom_fields.title")),1)]),_:1})):d("",!0),t(I,{class:"mt-5"},{default:o(()=>[(a(!0),B(G,null,q(y.value,(u,$)=>(a(),c(_,{key:$,"content-loading":f.value,label:u.custom_field.label},{default:o(()=>[u.type==="Switch"?(a(),B("p",Be,[u.default_answer===1?(a(),B("span",$e,h(e.$t("general.yes")),1)):(a(),B("span",we,h(e.$t("general.no")),1))])):(a(),B("p",ke,h(u.default_answer),1))]),_:2},1032,["content-loading","label"]))),128))]),_:1})])}}},Te={},Ee={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Ie={class:"flex justify-between mt-1 mb-6"},De={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},Ve={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Se={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ae={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Pe={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"};function Fe(R,w){const s=i("BaseContentPlaceholdersText"),f=i("BaseContentPlaceholdersBox"),y=i("BaseContentPlaceholders");return a(),c(y,{class:"grid grid-cols-12"},{default:o(()=>[r("div",Ee,[r("div",Ie,[t(s,{class:"h-10 w-36",lines:1}),t(s,{class:"h-10 w-40 !mt-0",lines:1})]),t(f,{class:"h-80 xl:h-72 sm:w-full"})]),r("div",De,[r("div",Ve,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})]),r("div",Se,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})]),r("div",Ae,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})]),r("div",Pe,[t(s,{class:"h-3 w-14 xl:h-4",lines:1}),t(s,{class:"w-20 h-5 xl:h-6",lines:1})])])]),_:1})}const je=te(Te,[["render",Fe]]),Re={key:1,class:"grid grid-cols-12"},Le={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Me={class:"flex justify-between mt-1 mb-6"},Ne={class:"flex items-center"},Oe={class:"w-40 h-10"},Ue={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},ze={class:"px-6 py-2"},He={class:"text-xs leading-5 lg:text-sm"},Ye={key:0,class:"block mt-1 text-xl font-semibold leading-8"},Ge={class:"px-6 py-2"},qe={class:"text-xs leading-5 lg:text-sm"},Xe={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#00c99c"}},Ke={class:"px-6 py-2"},Qe={class:"text-xs leading-5 lg:text-sm"},Je={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#fb7178"}},We={class:"px-6 py-2"},Ze={class:"text-xs leading-5 lg:text-sm"},et={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#5851d8"}},tt={__name:"CustomerChart",setup(R){se();const w=M();K("utils");const{t:s}=O.useI18n(),f=N();let y=P(!1),e=L({}),p=L({}),x=L([{label:s("dateRange.this_year"),value:"This year"},{label:s("dateRange.previous_year"),value:"Previous year"}]),_=P("This year");const I=E(()=>e.expenseTotals?e.expenseTotals:[]),S=E(()=>e.netProfits?e.netProfits:[]),u=E(()=>e&&e.months?e.months:[]),$=E(()=>e.receiptTotals?e.receiptTotals:[]),C=E(()=>e.invoiceTotals?e.invoiceTotals:[]);ae(f,()=>{f.params.id&&T(),_.value="This year"},{immediate:!0});async function T(){y.value=!1;let m=await w.fetchViewCustomer({id:f.params.id});m.data&&(Object.assign(e,m.data.meta.chartData),Object.assign(p,m.data.data)),y.value=!0}async function v(m){let l={id:f.params.id};m==="Previous year"?l.previous_year=!0:l.this_year=!0;let g=await w.fetchViewCustomer(l);return g.data.meta.chartData&&Object.assign(e,g.data.meta.chartData),!0}return(m,l)=>{const g=i("BaseIcon"),k=i("BaseMultiselect"),A=i("BaseFormatMoney"),F=i("BaseCard");return a(),c(F,{class:"flex flex-col mt-6"},{default:o(()=>[n(w).isFetchingViewData?(a(),c(je,{key:0})):(a(),B("div",Re,[r("div",Le,[r("div",Me,[r("h6",Ne,[t(g,{name:"ChartBarSquareIcon",class:"h-5 text-primary-400"}),V(" "+h(m.$t("dashboard.monthly_chart.title")),1)]),r("div",Oe,[t(k,{modelValue:n(_),"onUpdate:modelValue":l[0]||(l[0]=j=>le(_)?_.value=j:_=j),options:n(x),"allow-empty":!1,"show-labels":!1,placeholder:m.$t("dashboard.select_year"),"can-deselect":!1,onSelect:v},null,8,["modelValue","options","placeholder"])])]),n(y)?(a(),c(ce,{key:0,invoices:C.value,expenses:I.value,receipts:$.value,income:S.value,labels:u.value,class:"sm:w-full"},null,8,["invoices","expenses","receipts","income","labels"])):d("",!0)]),r("div",Ue,[r("div",ze,[r("span",He,h(m.$t("dashboard.chart_info.total_sales")),1),l[1]||(l[1]=r("br",null,null,-1)),n(y)?(a(),B("span",Ye,[t(A,{amount:n(e).salesTotal,currency:n(p).currency},null,8,["amount","currency"])])):d("",!0)]),r("div",Ge,[r("span",qe,h(m.$t("dashboard.chart_info.total_receipts")),1),l[2]||(l[2]=r("br",null,null,-1)),n(y)?(a(),B("span",Xe,[t(A,{amount:n(e).totalExpenses,currency:n(p).currency},null,8,["amount","currency"])])):d("",!0)]),r("div",Ke,[r("span",Qe,h(m.$t("dashboard.chart_info.total_expense")),1),l[3]||(l[3]=r("br",null,null,-1)),n(y)?(a(),B("span",Je,[t(A,{amount:n(e).totalExpenses,currency:n(p).currency},null,8,["amount","currency"])])):d("",!0)]),r("div",We,[r("span",Ze,h(m.$t("dashboard.chart_info.net_income")),1),l[4]||(l[4]=r("br",null,null,-1)),n(y)?(a(),B("span",et,[t(A,{amount:n(e).netProfit,currency:n(p).currency},null,8,["amount","currency"])])):d("",!0)])])])),t(Ce)]),_:1})}}},ot={__name:"View",setup(R){K("utils"),ne();const w=M(),s=oe(),{t:f}=O.useI18n(),y=re(),e=N();P(null);const p=E(()=>w.selectedViewCustomer.customer?w.selectedViewCustomer.customer.name:"");let x=E(()=>w.isFetchingViewData);function _(){return s.hasAbilities([D.CREATE_ESTIMATE,D.CREATE_INVOICE,D.CREATE_PAYMENT,D.CREATE_EXPENSE])}function I(){return s.hasAbilities([D.DELETE_CUSTOMER,D.EDIT_CUSTOMER])}function S(){y.push("/admin/customers")}return(u,$)=>{const C=i("BaseButton"),T=i("router-link"),v=i("BaseIcon"),m=i("BaseDropdownItem"),l=i("BaseDropdown"),g=i("BasePageHeader"),k=i("BasePage");return a(),c(k,{class:"xl:pl-96"},{default:o(()=>[t(g,{title:p.value},{actions:o(()=>[n(s).hasAbilities(n(D).EDIT_CUSTOMER)?(a(),c(T,{key:0,to:`/admin/customers/${n(e).params.id}/edit`},{default:o(()=>[t(C,{class:"mr-3",variant:"primary-outline","content-loading":n(x)},{default:o(()=>[V(h(u.$t("general.edit")),1)]),_:1},8,["content-loading"])]),_:1},8,["to"])):d("",!0),_()?(a(),c(l,{key:1,position:"bottom-end","content-loading":n(x)},{activator:o(()=>[t(C,{class:"mr-3",variant:"primary","content-loading":n(x)},{default:o(()=>[V(h(u.$t("customers.new_transaction")),1)]),_:1},8,["content-loading"])]),default:o(()=>[n(s).hasAbilities(n(D).CREATE_ESTIMATE)?(a(),c(T,{key:0,to:`/admin/estimates/create?customer=${u.$route.params.id}`},{default:o(()=>[t(m,{class:""},{default:o(()=>[t(v,{name:"DocumentIcon",class:"mr-3 text-gray-600"}),V(" "+h(u.$t("estimates.new_estimate")),1)]),_:1})]),_:1},8,["to"])):d("",!0),n(s).hasAbilities(n(D).CREATE_INVOICE)?(a(),c(T,{key:1,to:`/admin/invoices/create?customer=${u.$route.params.id}`},{default:o(()=>[t(m,null,{default:o(()=>[t(v,{name:"DocumentTextIcon",class:"mr-3 text-gray-600"}),V(" "+h(u.$t("invoices.new_invoice")),1)]),_:1})]),_:1},8,["to"])):d("",!0),n(s).hasAbilities(n(D).CREATE_PAYMENT)?(a(),c(T,{key:2,to:`/admin/payments/create?customer=${u.$route.params.id}`},{default:o(()=>[t(m,null,{default:o(()=>[t(v,{name:"CreditCardIcon",class:"mr-3 text-gray-600"}),V(" "+h(u.$t("payments.new_payment")),1)]),_:1})]),_:1},8,["to"])):d("",!0),n(s).hasAbilities(n(D).CREATE_EXPENSE)?(a(),c(T,{key:3,to:`/admin/expenses/create?customer=${u.$route.params.id}`},{default:o(()=>[t(m,null,{default:o(()=>[t(v,{name:"CalculatorIcon",class:"mr-3 text-gray-600"}),V(" "+h(u.$t("expenses.new_expense")),1)]),_:1})]),_:1},8,["to"])):d("",!0)]),_:1},8,["content-loading"])):d("",!0),I()?(a(),c(ue,{key:2,class:X({"ml-3":n(x)}),row:n(w).selectedViewCustomer,"load-data":S},null,8,["class","row"])):d("",!0)]),_:1},8,["title"]),t(be),t(tt)]),_:1})}}};export{ot as default};
