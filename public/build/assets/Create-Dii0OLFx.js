import{v as z,F as J,e as _,j as b,f as c,g as f,i as K,N as O,K as V,w as u,r as i,n as Q,aj as W,J as C,h as X,o as B,a as o,b as h,m as Y,c as Z,l as e,Q as x,R as ee,q as ae,t as te,L as oe,M as ne}from"./main-sWfemrx7.js";import{V as se}from"./index-DCnR5pt2.js";import{u as re}from"./users-D2PK4SFP.js";const le={class:"grid grid-cols-12"},ue={class:"space-y-6"},pe={__name:"Create",setup(ie){const t=re(),{t:d}=z.useI18n(),q=O(),S=Q(),k=J();let p=_(!1),r=_(!1);_([]);let y=_([]);const g=b(()=>q.name==="users.edit"),I=b(()=>g.value?d("users.edit_user"):d("users.new_user")),L=b(()=>({userData:{name:{required:c.withMessage(d("validation.required"),f),minLength:c.withMessage(d("validation.name_min_length",{count:3}),C(3))},email:{required:c.withMessage(d("validation.required"),f),email:c.withMessage(d("validation.email_incorrect"),X)},password:{required:W(function(){return c.withMessage(d("validation.required"),f),!g.value}),minLength:c.withMessage(d("validation.password_min_length",{count:8}),C(8))},companies:{required:c.withMessage(d("validation.required"),f)}}})),N={role:{required:c.withMessage(d("validation.required"),f)}},n=K(L,t,{$scope:!0});j(),t.resetUserData();async function j(){var l;r.value=!0;try{g.value&&await t.fetchUser(q.params.id);let a=await k.fetchUserCompanies();(l=a==null?void 0:a.data)!=null&&l.data&&(y.value=a.data.data.map(m=>(m.role=null,m)))}catch{r.value=!1}r.value=!1}async function E(){if(n.value.$touch(),n.value.$invalid)return!0;try{p.value=!0;let l={...t.userData,companies:t.userData.companies.map(m=>({role:m.role,id:m.id}))};await(g.value?t.updateUser:t.addUser)(l),S.push("/admin/users"),p.value=!1}catch{p.value=!1}}return(l,a)=>{const m=i("BaseBreadcrumbItem"),G=i("BaseBreadcrumb"),P=i("BasePageHeader"),$=i("BaseInput"),v=i("BaseInputGroup"),M=i("BaseMultiselect"),R=i("BaseInputGrid"),F=i("BaseIcon"),A=i("BaseButton"),H=i("BaseCard"),T=i("BasePage");return B(),V(T,null,{default:u(()=>[o(P,{title:I.value},{default:u(()=>[o(G,null,{default:u(()=>[o(m,{title:l.$t("general.home"),to:"dashboard"},null,8,["title"]),o(m,{title:l.$t("users.user",2),to:"/admin/users"},null,8,["title"]),o(m,{title:I.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),h("form",{action:"",autocomplete:"off",onSubmit:Y(E,["prevent"])},[h("div",le,[o(H,{class:"mt-6 col-span-12 md:col-span-8"},{default:u(()=>[o(R,{layout:"one-column"},{default:u(()=>[o(v,{"content-loading":e(r),label:l.$t("users.name"),error:e(n).userData.name.$error&&e(n).userData.name.$errors[0].$message,required:""},{default:u(()=>[o($,{modelValue:e(t).userData.name,"onUpdate:modelValue":a[0]||(a[0]=s=>e(t).userData.name=s),modelModifiers:{trim:!0},"content-loading":e(r),invalid:e(n).userData.name.$error,onInput:a[1]||(a[1]=s=>e(n).userData.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"]),o(v,{"content-loading":e(r),label:l.$t("users.email"),error:e(n).userData.email.$error&&e(n).userData.email.$errors[0].$message,required:""},{default:u(()=>[o($,{modelValue:e(t).userData.email,"onUpdate:modelValue":a[2]||(a[2]=s=>e(t).userData.email=s),modelModifiers:{trim:!0},type:"email","content-loading":e(r),invalid:e(n).userData.email.$error,onInput:a[3]||(a[3]=s=>e(n).userData.email.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"]),o(v,{"content-loading":e(r),label:l.$t("users.companies"),error:e(n).userData.companies.$error&&e(n).userData.companies.$errors[0].$message,required:""},{default:u(()=>[o(M,{modelValue:e(t).userData.companies,"onUpdate:modelValue":a[4]||(a[4]=s=>e(t).userData.companies=s),mode:"tags",object:!0,autocomplete:"new-password",label:"name",options:e(y),"value-prop":"id",invalid:e(n).userData.companies.$error,"content-loading":e(r),searchable:"","can-deselect":!1,class:"w-full","track-by":"name"},null,8,["modelValue","options","invalid","content-loading"])]),_:1},8,["content-loading","label","error"]),(B(!0),Z(x,null,ee(e(t).userData.companies,(s,D)=>(B(),V(e(se),{key:D,state:s,rules:N},{default:u(({v:w})=>[h("div",ue,[o(v,{"content-loading":e(r),label:l.$t("users.select_company_role",{company:s.name}),error:w.role.$error&&w.role.$errors[0].$message,required:""},{default:u(()=>[o(M,{modelValue:e(t).userData.companies[D].role,"onUpdate:modelValue":U=>e(t).userData.companies[D].role=U,"value-prop":"name","track-by":"id",autocomplete:"off","content-loading":e(r),label:"name",options:e(t).userData.companies[D].roles,"can-deselect":!1,invalid:w.role.$invalid,onChange:U=>w.role.$touch()},null,8,["modelValue","onUpdate:modelValue","content-loading","options","invalid","onChange"])]),_:2},1032,["content-loading","label","error"])])]),_:2},1032,["state"]))),128)),o(v,{"content-loading":e(r),label:l.$t("users.password"),error:e(n).userData.password.$error&&e(n).userData.password.$errors[0].$message,required:!g.value},{default:u(()=>[o($,{modelValue:e(t).userData.password,"onUpdate:modelValue":a[5]||(a[5]=s=>e(t).userData.password=s),name:"new-password",autocomplete:"new-password","content-loading":e(r),type:"password",invalid:e(n).userData.password.$error,onInput:a[6]||(a[6]=s=>e(n).userData.password.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error","required"]),o(v,{"content-loading":e(r),label:l.$t("users.phone")},{default:u(()=>[o($,{modelValue:e(t).userData.phone,"onUpdate:modelValue":a[7]||(a[7]=s=>e(t).userData.phone=s),modelModifiers:{trim:!0},"content-loading":e(r)},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label"])]),_:1}),o(A,{"content-loading":e(r),type:"submit",loading:e(p),disabled:e(p),class:"mt-6"},{left:u(s=>[e(p)?oe("",!0):(B(),V(F,{key:0,name:"ArrowDownOnSquareIcon",class:ne(s.class)},null,8,["class"]))]),default:u(()=>[ae(" "+te(g.value?l.$t("users.update_user"):l.$t("users.save_user")),1)]),_:1},8,["content-loading","loading","disabled"])]),_:1})])],32)]),_:1})}}};export{pe as default};
