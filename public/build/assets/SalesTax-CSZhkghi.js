import{av as Z,G as W,O as oe,e as R,I as me,a7 as ne,v as X,j as P,P as H,r as x,c as w,o as l,b as a,a as s,t as $,a8 as he,w as c,l as m,q,K as C,L as O,F as ee,au as pe,N as $e,S as K,f as z,ah as te,aN as we,g as Y,i as re,Q,R as J,V as le,ap as ye,aQ as Ie,ao as Be,aR as Se,M as G,T as Pe,aS as Te,aT as ke,at as Me,u as Ce,J as De,k as fe,m as xe,H as Ve}from"./main-DlOnIu1m.js";import{D as je,d as Ee}from"./DragIcon-BojFknlc.js";import{_ as qe}from"./SelectNotePopup-CwG82MZ4.js";const Ae={class:"flex items-center justify-between mb-3"},Le={class:"flex items-center text-base",style:{flex:"4"}},Oe={class:"pr-2 mb-0",align:"right"},Ue={class:"absolute left-3.5"},ze={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Ne={class:"text-sm text-right",style:{flex:"3"}},Fe={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Ye={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(t,{emit:v}){const e=t,r=v,I=Z(),g=W(),u=oe(),B=R(null),S=me({...e.taxData});ne("utils");const{t:p}=X.useI18n(),V=P(()=>I.taxTypes.map(i=>({...i})).map(i=>(e.taxes.find(_=>_.tax_type_id===i.id)?i.disabled=!0:i.disabled=!1,i))),E=P(()=>{if(e.discountedTotal&&S.percent){const y=e.store[e.storeProp].tax_per_item==="YES",i=e.store[e.storeProp].discount_per_item==="YES";return y&&!i?d():e.discountedTotal*S.percent/100}return 0});H(()=>e.discountedTotal,()=>{T()}),H(()=>e.totalTax,()=>{T()}),H(()=>E.value,()=>{T()}),e.taxData.tax_type_id>0&&(B.value=I.taxTypes.find(y=>y.id===e.taxData.tax_type_id)),T();function A(y){S.percent=y.percent,S.tax_type_id=y.id,S.name=y.name,T()}function T(){S.tax_type_id!==0&&r("update",{index:e.index,item:{...S,amount:E.value}})}function o(){let y={itemIndex:e.itemIndex,taxIndex:e.index};g.openModal({title:p("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:y,size:"sm"})}function f(y){e.store.$patch(i=>{i[e.storeProp].items[e.itemIndex].taxes.splice(y,1),i[e.storeProp].items[e.itemIndex].tax=0,i[e.storeProp].items[e.itemIndex].totalTax=0})}function d(){let y=0,i=0;const n=e.discountedTotal,_=e.store[e.storeProp].discount?e.store[e.storeProp].discount:0,k=e.store[e.storeProp].discount_type;if(_>0){e.store[e.storeProp].items.forEach(b=>{y+=b.total});const M=(n/y).toFixed(2);i=k==="fixed"?_*100:y*_/100;const j=Math.round(i*M),D=n-j;return Math.round(D*S.percent/100)}return Math.round(e.discountedTotal*S.percent/100)}return(y,i)=>{const n=x("BaseIcon"),_=x("BaseMultiselect"),k=x("BaseFormatMoney");return l(),w("div",Ae,[a("div",Le,[a("label",Oe,$(y.$t("invoices.item.tax")),1),s(_,{modelValue:B.value,"onUpdate:modelValue":[i[0]||(i[0]=M=>B.value=M),i[1]||(i[1]=M=>A(M))],"value-prop":"id",options:V.value,placeholder:y.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},he({singlelabel:c(({value:M})=>[a("div",Ue,$(M.name)+" - "+$(M.percent)+" % ",1)]),option:c(({option:M})=>[q($(M.name)+" - "+$(M.percent)+" % ",1)]),_:2},[m(u).hasAbilities(t.ability)?{name:"action",fn:c(()=>[a("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:o},[s(n,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),a("label",ze,$(y.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),i[3]||(i[3]=a("br",null,null,-1))]),a("div",Ne,[s(k,{amount:E.value,currency:t.currency},null,8,["amount","currency"])]),a("div",Fe,[t.taxes.length&&t.index!==t.taxes.length-1?(l(),C(n,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:i[2]||(i[2]=M=>f(t.index))})):O("",!0)])])}}},Ge={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Re={colspan:"5",class:"p-0 text-left align-top"},We={class:"w-full"},Xe={key:0,style:{width:"15%","min-width":"160px"}},Ke={class:"px-5 py-4 text-left align-top"},Qe={class:"flex justify-start"},He={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},Je={class:"px-5 py-4 text-right align-top"},Ze={class:"px-5 py-4 text-left align-top"},et={class:"flex flex-col"},tt={class:"flex-auto flex-fill bd-highlight"},st={class:"relative w-full"},at={key:0,class:"px-5 py-4 text-left align-top"},ot={class:"flex flex-col"},nt={class:"flex",style:{width:"120px"},role:"group"},rt={class:"flex items-center"},lt={class:"px-5 py-4 text-right align-top"},it={class:"flex items-center justify-end text-sm"},dt={class:"flex items-center justify-center w-6 h-10 mx-2"},ut={key:0},ct={colspan:"4",class:"px-5 py-4 text-left align-top"},mt={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(t,{emit:v}){const e=t,r=ee(),I=pe();$e();const{t:g}=X.useI18n(),u=P({get:()=>e.itemData.quantity,set:b=>{D("quantity",parseFloat(b))}}),B=P({get:()=>{const b=e.itemData.price;return parseFloat(b)>0?b/100:b},set:b=>{if(parseFloat(b)>0){let h=Math.round(b*100);D("price",h)}else D("price",b);i()}}),S=P(()=>Math.round(e.itemData.price*e.itemData.quantity)),p=P({get:()=>e.itemData.discount,set:b=>{D("discount",b),i()}}),V=P(()=>S.value-e.itemData.discount_val),E=P(()=>e.currency?e.currency:r.selectedCompanyCurrency),A=P(()=>e.store[e.storeProp].items.length!=1),T=P(()=>Math.round(K.sumBy(e.itemData.taxes,function(b){return b.amount?b.amount:0}))),o=P(()=>T.value),f={name:{required:z.withMessage(g("validation.required"),Y)},quantity:{required:z.withMessage(g("validation.required"),Y),maxLength:z.withMessage(g("validation.amount_maxlength"),te(20))},price:{required:z.withMessage(g("validation.required"),Y),maxLength:z.withMessage(g("validation.price_maxlength"),te(20))},discount_val:{between:z.withMessage(g("validation.discount_maxlength"),we(0,P(()=>Math.abs(S.value))))},description:{maxLength:z.withMessage(g("validation.notes_maxlength"),te(65e3))}},d=re(f,P(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function y(b){e.store.$patch(U=>{U[e.storeProp].items[e.index].taxes[b.index]=b.item});let h=e.itemData.taxes[e.itemData.taxes.length-1];(h==null?void 0:h.tax_type_id)!==0&&e.store.$patch(U=>{U[e.storeProp].items[e.index].taxes.push({...Ie,id:ye.raw()})}),j()}function i(){const b=e.store[e.storeProp].items[e.index].discount,h=Math.abs(S.value);e.itemData.discount_type==="percentage"?D("discount_val",Math.round(h*b/100)):D("discount_val",Math.min(Math.round(b*100),h))}function n(b){D("name",b)}function _(b){e.store.$patch(h=>{if(h[e.storeProp].items[e.index].name=b.name,h[e.storeProp].items[e.index].price=b.price,h[e.storeProp].items[e.index].item_id=b.id,h[e.storeProp].items[e.index].description=b.description,b.unit&&(h[e.storeProp].items[e.index].unit_name=b.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&b.taxes){let U=0;b.taxes.forEach(F=>{y({index:U,item:{...F}}),U++})}h[e.storeProp].exchange_rate&&(h[e.storeProp].items[e.index].price/=h[e.storeProp].exchange_rate)}),I.fetchItems(),j()}function k(){e.itemData.discount_type!=="fixed"&&(D("discount_val",Math.round(e.itemData.discount*100)),D("discount_type","fixed"))}function M(){e.itemData.discount_type!=="percentage"&&(D("discount_val",S.value*e.itemData.discount/100),D("discount_type","percentage"))}function j(){var U,F;let b=(F=(U=e.store[e.storeProp])==null?void 0:U.items[e.index])==null?void 0:F.taxes;b||(b=[]);let h={...e.store[e.storeProp].items[e.index],index:e.index,total:V.value,sub_total:S.value,totalSimpleTax:T.value,totalTax:o.value,tax:o.value,taxes:[...b],tax_type_ids:b.flatMap(L=>L.tax_type_id?L.tax_type_id:[])};e.store.updateItem(h)}function D(b,h){e.store.$patch(U=>{U[e.storeProp].items[e.index][b]=h}),j()}return(b,h)=>{const U=x("BaseItemSelect"),F=x("BaseInput"),L=x("BaseMoney"),ie=x("BaseIcon"),ge=x("BaseButton"),de=x("BaseDropdownItem"),ve=x("BaseDropdown"),ue=x("BaseContentPlaceholdersText"),ce=x("BaseContentPlaceholders"),_e=x("BaseFormatMoney");return l(),w("tr",Ge,[a("td",Re,[a("table",We,[a("colgroup",null,[h[6]||(h[6]=a("col",{style:{width:"40%","min-width":"280px"}},null,-1)),h[7]||(h[7]=a("col",{style:{width:"10%","min-width":"120px"}},null,-1)),h[8]||(h[8]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(l(),w("col",Xe)):O("",!0),h[9]||(h[9]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),a("tbody",null,[a("tr",null,[a("td",Ke,[a("div",Qe,[a("div",He,[s(je)]),s(U,{type:"Invoice",item:t.itemData,invalid:m(d).name.$error,"invalid-description":m(d).description.$error,taxes:t.itemData.taxes,index:t.index,"store-prop":t.storeProp,store:t.store,onSearch:n,onSelect:_},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),a("td",Je,[s(F,{modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=N=>u.value=N),invalid:m(d).quantity.$error,"content-loading":t.loading,type:"number",small:"",step:"any",onChange:h[1]||(h[1]=N=>j()),onInput:h[2]||(h[2]=N=>m(d).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),a("td",Ze,[a("div",et,[a("div",tt,[a("div",st,[(l(),C(L,{key:E.value,modelValue:B.value,"onUpdate:modelValue":h[3]||(h[3]=N=>B.value=N),invalid:m(d).price.$error,"content-loading":t.loading,currency:E.value},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),t.store[t.storeProp].discount_per_item==="YES"?(l(),w("td",at,[a("div",ot,[a("div",nt,[s(F,{modelValue:p.value,"onUpdate:modelValue":h[4]||(h[4]=N=>p.value=N),invalid:m(d).discount_val.$error,"content-loading":t.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s(ve,{position:"bottom-end"},{activator:c(()=>[s(ge,{"content-loading":t.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[a("span",rt,[q($(t.itemData.discount_type=="fixed"?t.currency.symbol:"%")+" ",1),s(ie,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:c(()=>[s(de,{onClick:k},{default:c(()=>[q($(b.$t("general.fixed")),1)]),_:1}),s(de,{onClick:M},{default:c(()=>[q($(b.$t("general.percentage")),1)]),_:1})]),_:1})])])])):O("",!0),a("td",lt,[a("div",it,[a("span",null,[t.loading?(l(),C(ce,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),C(_e,{key:1,amount:V.value,currency:E.value},null,8,["amount","currency"]))]),a("div",dt,[A.value?(l(),C(ie,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:h[5]||(h[5]=N=>t.store.removeItem(t.index))})):O("",!0)])])])]),t.store[t.storeProp].tax_per_item==="YES"?(l(),w("tr",ut,[h[10]||(h[10]=a("td",{class:"px-5 py-4 text-left align-top"},null,-1)),a("td",ct,[t.loading?(l(),C(ce,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(l(!0),w(Q,{key:1},J(t.itemData.taxes,(N,be)=>(l(),C(Ye,{key:N.id,index:be,"item-index":t.index,"tax-data":N,taxes:t.itemData.taxes,"discounted-total":V.value,"total-tax":T.value,total:S.value,currency:t.currency,"update-items":j,ability:m(le).CREATE_INVOICE,store:t.store,"store-prop":t.storeProp,discount:p.value,onUpdate:y},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):O("",!0)])])])])}}},pt={class:"text-center item-table min-w-full"},yt={key:0,style:{width:"15%","min-width":"160px"}},ft={class:"bg-white border border-gray-200 border-solid"},xt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},gt={key:1,class:"pl-7"},vt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},_t={key:1},bt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},ht={key:1},$t={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},wt={key:1},It={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Bt={key:1,class:"pr-10 column-heading"},ks={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(t){const v=t,e=ee(),r=P(()=>v.currency?v.currency:e.selectedCompanyCurrency);return(I,g)=>{const u=x("BaseContentPlaceholdersText"),B=x("BaseContentPlaceholders"),S=x("BaseIcon");return l(),w(Q,null,[a("table",pt,[a("colgroup",null,[g[2]||(g[2]=a("col",{style:{width:"40%","min-width":"280px"}},null,-1)),g[3]||(g[3]=a("col",{style:{width:"10%","min-width":"120px"}},null,-1)),g[4]||(g[4]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(l(),w("col",yt)):O("",!0),g[5]||(g[5]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),a("thead",ft,[a("tr",null,[a("th",xt,[t.isLoading?(l(),C(B,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("span",gt,$(I.$t("items.item",2)),1))]),a("th",vt,[t.isLoading?(l(),C(B,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("span",_t,$(I.$t("invoices.item.quantity")),1))]),a("th",bt,[t.isLoading?(l(),C(B,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("span",ht,$(I.$t("invoices.item.price")),1))]),t.store[t.storeProp].discount_per_item==="YES"?(l(),w("th",$t,[t.isLoading?(l(),C(B,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("span",wt,$(I.$t("invoices.item.discount")),1))])):O("",!0),a("th",It,[t.isLoading?(l(),C(B,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("span",Bt,$(I.$t("invoices.item.amount")),1))])])]),s(m(Ee),{modelValue:t.store[t.storeProp].items,"onUpdate:modelValue":g[0]||(g[0]=p=>t.store[t.storeProp].items=p),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:p,index:V})=>[(l(),C(mt,{key:p.id,index:V,"item-data":p,loading:t.isLoading,currency:r.value,"item-validation-scope":t.itemValidationScope,"invoice-items":t.store[t.storeProp].items,store:t.store,"store-prop":t.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),a("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:g[1]||(g[1]=(...p)=>t.store.addItem&&t.store.addItem(...p))},[s(S,{name:"PlusCircleIcon",class:"mr-2"}),q(" "+$(I.$t("general.add_new_item")),1)])],64)}}},St={class:"flex items-center justify-between w-full mt-2 text-sm"},Pt={class:"font-semibold leading-5 text-gray-500 uppercase"},Tt={class:"flex items-center justify-center text-lg text-black"},kt={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:v}){const e=t,r=v;ne("$utils");const I=P(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Be(()=>{e.store.getSubtotalWithDiscount&&g(),e.store.getTotalSimpleTax&&g()});function g(){r("update",{...e.tax,amount:I.value})}return(u,B)=>{const S=x("BaseFormatMoney"),p=x("BaseIcon");return l(),w("div",St,[a("label",Pt,$(t.tax.name)+" ("+$(t.tax.percent)+" %) ",1),a("label",Tt,[s(S,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),s(p,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:B[0]||(B[0]=V=>u.$emit("remove",t.tax.id))})])])}}},Mt={class:"w-full mt-4 tax-select"},Ct={class:"relative w-full max-w-md px-4"},Dt={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Vt={class:"relative bg-white"},jt={class:"relative p-4"},Et={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},qt=["onClick"],At={class:"flex justify-between px-2"},Lt={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Ot={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},Ut={key:1,class:"flex justify-center p-5 text-gray-400"},zt={class:"text-base text-gray-500 cursor-pointer"},Nt={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},Ft={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:v}){const e=t,r=v,I=W(),g=Z(),u=oe(),{t:B}=X.useI18n(),S=R(null),p=P(()=>S.value?g.taxTypes.filter(function(T){return T.name.toLowerCase().indexOf(S.value.toLowerCase())!==-1}):g.taxTypes),V=P(()=>e.store[e.storeProp].taxes);function E(T,o){r("select:taxType",{...T}),o()}function A(){I.openModal({title:B("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:T=>r("select:taxType",T)})}return(T,o)=>{const f=x("BaseIcon"),d=x("BaseInput");return l(),w("div",Mt,[s(m(ke),{class:"relative"},{default:c(({isOpen:y})=>[s(m(Se),{class:G([y?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[s(f,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),q(" "+$(T.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),a("div",Ct,[s(Pe,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[s(m(Te),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:i})=>[a("div",Dt,[a("div",Vt,[a("div",jt,[s(d,{modelValue:S.value,"onUpdate:modelValue":o[0]||(o[0]=n=>S.value=n),placeholder:T.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),p.value.length>0?(l(),w("div",Et,[(l(!0),w(Q,null,J(p.value,(n,_)=>(l(),w("div",{key:_,class:G([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":V.value.find(k=>k.tax_type_id===n.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:k=>E(n,i)},[a("div",At,[a("label",Lt,$(n.name),1),a("label",Ot,$(n.percent)+" % ",1)])],10,qt))),128))])):(l(),w("div",Ut,[a("label",zt,$(T.$t("general.no_tax_found")),1)]))]),m(u).hasAbilities(m(le).CREATE_TAX_TYPE)?(l(),w("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:A},[s(f,{name:"CheckCircleIcon",class:"text-primary-400"}),a("label",Nt,$(T.$t("estimates.add_new_tax")),1)])):O("",!0)])]),_:1})]),_:1})])]),_:1})])}}},Yt={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},Gt={class:"flex items-center justify-between w-full"},Rt={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},Wt={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Xt={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},Kt={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Qt={key:0,class:"flex items-center justify-between w-full mt-2"},Ht={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},Jt={key:3,class:"flex",style:{width:"140px"},role:"group"},Zt={class:"flex items-center"},es={key:1},ts={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},ss={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},as={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Ms={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const v=R(null),e=t;ne("$utils");const r=ee();H(()=>e.store[e.storeProp].items,o=>{S()},{deep:!0});const I=P({get:()=>e.store[e.storeProp].discount,set:o=>{e.store[e.storeProp].discount=o,S()}}),g=P({get:()=>e.store[e.storeProp].taxes,set:o=>{e.store.$patch(f=>{f[e.storeProp].taxes=o})}}),u=P(()=>{let o=[];return e.store[e.storeProp].items.forEach(f=>{f.taxes&&f.taxes.forEach(d=>{let y=o.find(i=>i.tax_type_id===d.tax_type_id);y?y.amount+=d.amount:d.tax_type_id&&o.push({tax_type_id:d.tax_type_id,amount:Math.round(d.amount),percent:d.percent,name:d.name})})}),o}),B=P(()=>e.currency?e.currency:r.selectedCompanyCurrency);function S(){const o=e.store[e.storeProp].discount;if(e.store[e.storeProp].discount_type==="percentage"){e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*o/100);return}e.store[e.storeProp].discount_val=Math.round(o*100)}function p(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function V(){if(e.store[e.storeProp].discount_type==="percentage")return;const o=Math.round(e.store[e.storeProp].discount*100)/100;e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*o/100),e.store[e.storeProp].discount_type="percentage"}function E(o){let f=0;e.store.getSubtotalWithDiscount&&o.percent&&(f=Math.round(e.store.getSubtotalWithDiscount*o.percent/100));let d={...le,id:ye.raw(),name:o.name,percent:o.percent,tax_type_id:o.id,amount:f};e.store.$patch(y=>{y[e.storeProp].taxes.push({...d})})}function A(o){const f=e.store[e.storeProp].taxes.find(d=>d.id===o.id);f&&Object.assign(f,{...o})}function T(o){const f=e.store[e.storeProp].taxes.findIndex(d=>d.id===o);e.store.$patch(d=>{d[e.storeProp].taxes.splice(f,1)})}return(o,f)=>{const d=x("BaseContentPlaceholdersText"),y=x("BaseContentPlaceholders"),i=x("BaseFormatMoney"),n=x("BaseInput"),_=x("BaseIcon"),k=x("BaseButton"),M=x("BaseDropdownItem"),j=x("BaseDropdown");return l(),w("div",Yt,[a("div",Gt,[t.isLoading?(l(),C(y,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("label",Rt,$(o.$t("estimates.sub_total")),1)),t.isLoading?(l(),C(y,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("label",Wt,[s(i,{amount:t.store.getSubTotal,currency:B.value},null,8,["amount","currency"])]))]),(l(!0),w(Q,null,J(u.value,D=>(l(),w("div",{key:D.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(l(),C(y,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(l(),w("label",Xt,$(D.name)+" - "+$(D.percent)+"% ",1)):O("",!0),t.isLoading?(l(),C(y,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(l(),w("label",Kt,[s(i,{amount:D.amount,currency:B.value},null,8,["amount","currency"])])):O("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(l(),w("div",Qt,[t.isLoading?(l(),C(y,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("label",Ht,$(o.$t("estimates.discount")),1)),t.isLoading?(l(),C(y,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(l(),w("div",Jt,[s(n,{modelValue:I.value,"onUpdate:modelValue":f[0]||(f[0]=D=>I.value=D),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(j,{position:"bottom-end"},{activator:c(()=>[s(k,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:c(()=>[a("span",Zt,[q($(t.store[t.storeProp].discount_type=="fixed"?B.value.symbol:"%")+" ",1),s(_,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:c(()=>[s(M,{onClick:p},{default:c(()=>[q($(o.$t("general.fixed")),1)]),_:1}),s(M,{onClick:V},{default:c(()=>[q($(o.$t("general.percentage")),1)]),_:1})]),_:1})]))])):O("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(l(),w("div",es,[(l(!0),w(Q,null,J(g.value,(D,b)=>(l(),C(kt,{key:D.id,index:b,tax:D,taxes:g.value,currency:t.currency,store:t.store,onRemove:T,onUpdate:A},null,8,["index","tax","taxes","currency","store"]))),128))])):O("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(l(),w("div",{key:2,ref_key:"taxModal",ref:v,class:"float-right pt-2 pb-4"},[s(Ft,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":E},null,8,["store-prop","store","type"])],512)):O("",!0),a("div",ts,[t.isLoading?(l(),C(y,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("label",ss,$(o.$t("estimates.total"))+" "+$(o.$t("estimates.amount"))+":",1)),t.isLoading?(l(),C(y,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),w("label",as,[s(i,{amount:t.store.getTotal,currency:B.value},null,8,["amount","currency"])]))])])}}},os={class:"flex text-gray-800 font-medium text-sm mb-2"},Cs={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(t){const v=t,e=W(),{t:r}=X.useI18n();function I(){let g="";v.storeProp=="newEstimate"?g=r("estimates.mark_as_default_estimate_template_description"):v.storeProp=="newInvoice"&&(g=r("invoices.mark_as_default_invoice_template_description")),e.openModal({title:r("general.choose_template"),componentName:"SelectTemplate",data:{templates:v.store.templates,store:v.store,storeProp:v.storeProp,isMarkAsDefault:v.isMarkAsDefault,markAsDefaultDescription:g}})}return(g,u)=>{const B=x("BaseIcon"),S=x("BaseButton");return l(),w("div",null,[a("label",os,[q($(g.$t("general.select_template"))+" ",1),u[0]||(u[0]=a("span",{class:"text-sm text-red-500"}," *",-1))]),s(S,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:I},{right:c(p=>[s(B,{name:"PencilIcon",class:G(p.class)},null,8,["class"])]),default:c(()=>[q(" "+$(t.store[t.storeProp].template_name),1)]),_:1})])}}},ns={class:"mb-6"},rs={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},ls={class:"text-gray-800 font-medium mb-4 text-sm"},Ds={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(t){const v=t;function e(r){v.store[v.storeProp].notes=""+r.notes}return(r,I)=>{const g=x("BaseCustomInput");return l(),w("div",ns,[a("div",rs,[s(qe,{type:t.type,onSelect:e},null,8,["type"])]),a("label",ls,$(r.$t("invoices.notes")),1),s(g,{modelValue:t.store[t.storeProp].notes,"onUpdate:modelValue":I[0]||(I[0]=u=>t.store[t.storeProp].notes=u),"content-loading":t.store.isFetchingInitialSettings,fields:t.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},is={class:"flex justify-between w-full"},ds={class:"px-8 py-8 sm:p-6"},us={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},cs=["onClick"],ms=["src","alt"],ps=["alt","src"],ys={key:1,class:"z-0 flex ml-3 pt-5"},fs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Vs={__name:"SelectTemplateModal",setup(t){const v=W(),e=oe(),r=R(""),I=P(()=>v.active&&v.componentName==="SelectTemplate"),g=P(()=>v.title);function u(){v.data.store[v.data.storeProp].template_name?r.value=v.data.store[v.data.storeProp].template_name:r.value=v.data.templates[0]}async function B(){await v.data.store.setTemplate(r.value),!v.data.store.isEdit&&v.data.isMarkAsDefault&&(v.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:r.value}}):v.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:r.value}})),p()}function S(){return new URL("/build/assets/tick-BkKo8A3q.png",import.meta.url)}function p(){v.closeModal(),setTimeout(()=>{v.$reset()},300)}return(V,E)=>{const A=x("BaseIcon"),T=x("BaseCheckbox"),o=x("BaseButton"),f=x("BaseModal");return l(),C(f,{show:I.value,onClose:p,onOpen:u},{header:c(()=>[a("div",is,[q($(g.value)+" ",1),s(A,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:p})])]),default:c(()=>[a("div",ds,[m(v).data?(l(),w("div",us,[(l(!0),w(Q,null,J(m(v).data.templates,(d,y)=>(l(),w("div",{key:y,class:G([{"border border-solid border-primary-500":r.value===d.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:i=>r.value=d.name},[a("img",{src:d.path,alt:d.name,class:"w-full min-h-[100px]"},null,8,ms),r.value===d.name?(l(),w("img",{key:0,alt:d.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:S()},null,8,ps)):O("",!0),a("span",{class:G(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":r.value===d.name,"text-gray-600":r.value!=d.name}])},$(d.name),3)],10,cs))),128))])):O("",!0),m(v).data.store.isEdit?O("",!0):(l(),w("div",ys,[s(T,{modelValue:m(v).data.isMarkAsDefault,"onUpdate:modelValue":E[0]||(E[0]=d=>m(v).data.isMarkAsDefault=d),"set-initial-value":!1,variant:"primary",label:V.$t("general.mark_as_default"),description:m(v).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),a("div",fs,[s(o,{class:"mr-3",variant:"primary-outline",onClick:p},{default:c(()=>[q($(V.$t("general.cancel")),1)]),_:1}),s(o,{variant:"primary",onClick:E[1]||(E[1]=d=>B())},{left:c(d=>[s(A,{name:"SaveIcon",class:G(d.class)},null,8,["class"])]),default:c(()=>[q(" "+$(V.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},xs={class:"flex justify-between w-full"},gs={class:"item-modal"},vs={class:"px-8 py-8 sm:p-6"},_s={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},js={__name:"ItemModal",emits:["newItem"],setup(t,{emit:v}){const e=W(),r=pe(),I=ee(),g=Z();Me(),Ce();const{t:u}=X.useI18n(),B=R(!1),S=R(I.selectedCompanySettings.tax_per_item),p=P(()=>e.active&&e.componentName==="ItemModal"),V=P({get:()=>r.currentItem.price/100,set:i=>{r.currentItem.price=Math.round(i*100)}}),E=P({get:()=>r.currentItem.taxes.map(i=>{if(i)return{...i,tax_type_id:i.id,tax_name:i.name+" ("+i.percent+"%)"}}),set:i=>{r.$patch(n=>{n.currentItem.taxes=i})}}),A=P(()=>S.value==="YES"),T={name:{required:z.withMessage(u("validation.required"),Y),minLength:z.withMessage(u("validation.name_min_length",{count:3}),De(3))},description:{maxLength:z.withMessage(u("validation.description_maxlength",{count:255}),te(255))}},o=re(T,P(()=>r.currentItem)),f=P(()=>g.taxTypes.map(i=>({...i,tax_name:i.name+" ("+i.percent+"%)"})));fe(()=>{o.value.$reset(),r.fetchItemUnits({limit:"all"})});async function d(){if(o.value.$touch(),o.value.$invalid)return!0;let i={...r.currentItem,taxes:r.currentItem.taxes.map(_=>({tax_type_id:_.id,amount:V.value*_.percent/100,percent:_.percent,name:_.name,collective_tax:0}))};B.value=!0,await(r.isEdit?r.updateItem:r.addItem)(i).then(_=>{B.value=!1,_.data.data&&e.data&&e.refreshData(_.data.data),y()})}function y(){e.closeModal(),setTimeout(()=>{r.resetCurrentItem(),e.$reset(),o.value.$reset()},300)}return(i,n)=>{const _=x("BaseIcon"),k=x("BaseInput"),M=x("BaseInputGroup"),j=x("BaseMoney"),D=x("BaseMultiselect"),b=x("BaseTextarea"),h=x("BaseInputGrid"),U=x("BaseButton"),F=x("BaseModal");return l(),C(F,{show:p.value,onClose:y},{header:c(()=>[a("div",xs,[q($(m(e).title)+" ",1),s(_,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:c(()=>[a("div",gs,[a("form",{action:"",onSubmit:xe(d,["prevent"])},[a("div",vs,[s(h,{layout:"one-column"},{default:c(()=>[s(M,{label:i.$t("items.name"),required:"",error:m(o).name.$error&&m(o).name.$errors[0].$message},{default:c(()=>[s(k,{modelValue:m(r).currentItem.name,"onUpdate:modelValue":n[0]||(n[0]=L=>m(r).currentItem.name=L),type:"text",invalid:m(o).name.$error,onInput:n[1]||(n[1]=L=>m(o).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(M,{label:i.$t("items.price")},{default:c(()=>[(l(),C(j,{key:m(I).selectedCompanyCurrency,modelValue:V.value,"onUpdate:modelValue":n[2]||(n[2]=L=>V.value=L),currency:m(I).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),s(M,{label:i.$t("items.unit")},{default:c(()=>[s(D,{modelValue:m(r).currentItem.unit_id,"onUpdate:modelValue":n[3]||(n[3]=L=>m(r).currentItem.unit_id=L),label:"name",options:m(r).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:i.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),A.value?(l(),C(M,{key:0,label:i.$t("items.taxes")},{default:c(()=>[s(D,{modelValue:E.value,"onUpdate:modelValue":n[4]||(n[4]=L=>E.value=L),options:f.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):O("",!0),s(M,{label:i.$t("items.description"),error:m(o).description.$error&&m(o).description.$errors[0].$message},{default:c(()=>[s(b,{modelValue:m(r).currentItem.description,"onUpdate:modelValue":n[5]||(n[5]=L=>m(r).currentItem.description=L),rows:"4",cols:"50",invalid:m(o).description.$error,onInput:n[6]||(n[6]=L=>m(o).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),a("div",_s,[s(U,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:c(()=>[q($(i.$t("general.cancel")),1)]),_:1}),s(U,{loading:B.value,disabled:B.value,variant:"primary",type:"submit"},{left:c(L=>[s(_,{name:"SaveIcon",class:G(L.class)},null,8,["class"])]),default:c(()=>[q(" "+$(m(r).isEdit?i.$t("general.update"):i.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},bs={class:"flex justify-between w-full"},hs={class:"flex flex-col"},$s={class:"text-sm text-gray-500 mt-1"},ws={class:"p-4 sm:p-6"},Is={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Bs={__name:"TaxationAddressModal",emits:["addTax"],setup(t,{emit:v}){const e=W();Ve();const r=me({state:"",city:"",address_street_1:"",zip:""}),I=R(!1),g=Z(),{t:u}=X.useI18n(),B=P(()=>e.active&&e.componentName==="TaxationAddressModal"),S=P(()=>({state:{required:z.withMessage(u("validation.required"),Y)},city:{required:z.withMessage(u("validation.required"),Y)},address_street_1:{required:z.withMessage(u("validation.required"),Y)},zip:{required:z.withMessage(u("validation.required"),Y)}})),p=re(S,P(()=>r));async function V(){if(p.value.$touch(),p.value.$invalid)return!0;let o={address:r};e.id&&(o.customer_id=e.id),r.address_street_1=r.address_street_1.replace(/(\r\n|\n|\r)/gm,""),I.value=!0,await g.fetchSalesTax(o).then(f=>{I.value=!1,E("addTax",f.data.data),T()}).catch(f=>{I.value=!1})}const E=v;function A(){var o,f,d,y;r.state=(o=e==null?void 0:e.data)==null?void 0:o.state,r.city=(f=e==null?void 0:e.data)==null?void 0:f.city,r.address_street_1=(d=e==null?void 0:e.data)==null?void 0:d.address_street_1,r.zip=(y=e==null?void 0:e.data)==null?void 0:y.zip}function T(){e.closeModal()}return(o,f)=>{const d=x("BaseIcon"),y=x("BaseInput"),i=x("BaseInputGroup"),n=x("BaseTextarea"),_=x("BaseInputGrid"),k=x("BaseButton"),M=x("BaseModal");return l(),C(M,{show:B.value,onClose:T,onOpen:A},{header:c(()=>[a("div",bs,[a("div",hs,[q($(m(e).title)+" ",1),a("p",$s,$(m(e).content),1)]),s(d,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:T})])]),default:c(()=>[a("form",{onSubmit:xe(V,["prevent"])},[a("div",ws,[s(_,{layout:"one-column"},{default:c(()=>[s(i,{required:"",error:m(p).state.$error&&m(p).state.$errors[0].$message,label:o.$t("customers.state")},{default:c(()=>[s(y,{modelValue:r.state,"onUpdate:modelValue":f[0]||(f[0]=j=>r.state=j),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:m(p).state.$error,onInput:f[1]||(f[1]=j=>m(p).state.$touch()),placeholder:o.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(i,{required:"",error:m(p).city.$error&&m(p).city.$errors[0].$message,label:o.$t("customers.city")},{default:c(()=>[s(y,{modelValue:r.city,"onUpdate:modelValue":f[2]||(f[2]=j=>r.city=j),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:m(p).city.$error,onInput:f[3]||(f[3]=j=>m(p).city.$touch()),placeholder:o.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(i,{required:"",error:m(p).address_street_1.$error&&m(p).address_street_1.$errors[0].$message,label:o.$t("customers.address")},{default:c(()=>[s(n,{modelValue:r.address_street_1,"onUpdate:modelValue":f[4]||(f[4]=j=>r.address_street_1=j),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:m(p).address_street_1.$error,onInput:f[5]||(f[5]=j=>m(p).address_street_1.$touch()),placeholder:o.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(i,{required:"",error:m(p).zip.$error&&m(p).zip.$errors[0].$message,label:o.$t("customers.zip_code")},{default:c(()=>[s(y,{modelValue:r.zip,"onUpdate:modelValue":f[6]||(f[6]=j=>r.zip=j),invalid:m(p).zip.$error,onInput:f[7]||(f[7]=j=>m(p).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:o.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),a("div",Is,[s(k,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:T},{default:c(()=>[q($(o.$t("general.cancel")),1)]),_:1}),s(k,{loading:I.value,variant:"primary",type:"submit"},{left:c(j=>[I.value?O("",!0):(l(),C(d,{key:0,name:"SaveIcon",class:G(j.class)},null,8,["class"]))]),default:c(()=>[q(" "+$(o.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},se="Sales Tax",ae="MODULE",Es={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(t){const v=W(),e=ee(),r=Z(),{t:I}=X.useI18n(),g=R(!1),u=t,B=P(()=>u.isEdit?u.store[u.storeProp].sales_tax_address_type==="billing":e.selectedCompanySettings.sales_tax_address_type==="billing"),S=P(()=>e.selectedCompanySettings.sales_tax_us_enabled==="YES"),p=P(()=>u.isEdit?u.store[u.storeProp].sales_tax_type==="customer_level":e.selectedCompanySettings.sales_tax_type==="customer_level"),V=P(()=>u.isEdit?u.store[u.storeProp].sales_tax_type==="company_level":e.selectedCompanySettings.sales_tax_type==="company_level"),E=P(()=>{if(p.value&&A.value){let n=B.value?u.customer.billing:u.customer.shipping;return{address:K.pick(n,["address_street_1","city","state","zip"]),customer_id:u.customer.id}}else if(V.value&&A.value)return{address:K.pick(address,["address_street_1","city","state","zip"])}}),A=P(()=>{var n,_;if(p.value){let k=B.value?(n=u.customer)==null?void 0:n.billing:(_=u.customer)==null?void 0:_.shipping;return T(k)}else if(V.value)return T(e.selectedCompany.address);return!1});H(()=>u.customer,(n,_)=>{if(n&&_&&p.value){o(n,_);return}!A.value&&p.value&&n?setTimeout(()=>{f()},500):p.value&&n?d():p.value&&!n&&i()}),fe(()=>{V.value&&(A.value?d():f())});function T(n){return n?n.address_street_1&&n.city&&n.state&&n.zip:!1}function o(n,_){const k=B.value?n.billing:n.shipping,M=B.value?_.billing:_.shipping,j=K.pick(k,["address_street_1","city","state","zip"]),D=K.pick(M,["address_street_1","city","state","zip"]);K.isEqual(j,D)||d()}function f(){var k,M;if(!S.value)return;let n=null,_="";p.value?B.value?(n=(k=u.customer)==null?void 0:k.billing,_=I("settings.taxations.add_billing_address")):(n=(M=u.customer)==null?void 0:M.shipping,_=I("settings.taxations.add_shipping_address")):(n=e.selectedCompany.address,_=I("settings.taxations.add_company_address")),v.openModal({title:_,content:I("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:n,id:p.value?u.customer.id:""})}async function d(){S.value&&(g.value=!0,await r.fetchSalesTax(E.value).then(n=>{y(n.data.data),g.value=!1}).catch(n=>{n.response.data.error&&setTimeout(()=>{f()},500),g.value=!1}))}function y(n){n.tax_type_id=n.id;const _=u.store[u.storeProp].taxes.findIndex(k=>k.name===se&&k.type===ae);_>-1?Object.assign(u.store[u.storeProp].taxes[_],n):u.store[u.storeProp].taxes.push(n)}function i(){const n=u.store[u.storeProp].taxes.findIndex(k=>k.name===se&&k.type===ae);n>-1&&u.store[u.storeProp].taxes.splice(n,1);let _=r.taxTypes.findIndex(k=>k.name===se&&k.type===ae);_>-1&&r.taxTypes.splice(_,1)}return(n,_)=>(l(),C(Bs,{onAddTax:y}))}};export{Es as _,Vs as a,js as b,ks as c,Ds as d,Cs as e,Ms as f};
