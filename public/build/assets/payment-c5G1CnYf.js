import{a6 as f,u as y,s as m,a3 as i,F as P,aA as g,N as w,ad as _}from"./main-BfksJgUh.js";const p={maxPayableAmount:Number.MAX_SAFE_INTEGER,selectedCustomer:"",currency:null,currency_id:"",customer_id:"",payment_number:"",payment_date:"",amount:0,invoice_id:"",notes:"",payment_method_id:"",customFields:[],fields:[]},v=(r=!1)=>{const u=r?window.pinia.defineStore:f,{global:d}=window.i18n;return u({id:"payment",state:()=>({payments:[],paymentTotalCount:0,selectAllField:!1,selectedPayments:[],selectedNote:null,showExchangeRate:!1,drivers:[],providers:[],paymentProviders:{id:null,name:"",driver:"",active:!1,settings:{key:"",secret:""}},currentPayment:{...p},paymentModes:[],currentPaymentMode:{id:"",name:null},isFetchingInitialData:!1}),getters:{isEdit:t=>!!t.paymentProviders.id},actions:{fetchPaymentInitialData(t){const s=P(),n=g(),e=w();this.isFetchingInitialData=!0;let a=[];t&&(a=[this.fetchPayment(e.params.id)]),Promise.all([this.fetchPaymentModes({limit:"all"}),this.getNextNumber(),...a]).then(async([c,o,l])=>{var h;t?l.data.data.invoice&&(this.currentPayment.maxPayableAmount=parseInt(l.data.data.invoice.due_amount)):!t&&o.data&&(await n.fetchNotes(),this.currentPayment.notes=(h=n.getDefaultNoteForType("Payment"))==null?void 0:h.notes,this.currentPayment.payment_date=_().format("YYYY-MM-DD"),this.currentPayment.payment_number=o.data.nextNumber,this.currentPayment.currency=s.selectedCompanyCurrency),this.isFetchingInitialData=!1}).catch(c=>{i(c)})},fetchPayments(t){return new Promise((s,n)=>{m.get("/api/v1/payments",{params:t}).then(e=>{this.payments=e.data.data,this.paymentTotalCount=e.data.meta.payment_total_count,s(e)}).catch(e=>{i(e),n(e)})})},fetchPayment(t){return new Promise((s,n)=>{m.get(`/api/v1/payments/${t}`).then(e=>{Object.assign(this.currentPayment,e.data.data),s(e)}).catch(e=>{i(e),n(e)})})},addPayment(t){return new Promise((s,n)=>{m.post("/api/v1/payments",t).then(e=>{this.payments.push(e.data),y().showNotification({type:"success",message:d.t("payments.created_message")}),s(e)}).catch(e=>{i(e),n(e)})})},updatePayment(t){return new Promise((s,n)=>{m.put(`/api/v1/payments/${t.id}`,t).then(e=>{if(e.data){let a=this.payments.findIndex(o=>o.id===e.data.data.id);this.payments[a]=t.payment,y().showNotification({type:"success",message:d.t("payments.updated_message")})}s(e)}).catch(e=>{i(e),n(e)})})},deletePayment(t){const s=y();return new Promise((n,e)=>{m.post("/api/v1/payments/delete",t).then(a=>{let c=this.payments.findIndex(o=>o.id===t);this.payments.splice(c,1),s.showNotification({type:"success",message:d.t("payments.deleted_message",1)}),n(a)}).catch(a=>{i(a),e(a)})})},deleteMultiplePayments(){const t=y();return new Promise((s,n)=>{m.post("/api/v1/payments/delete",{ids:this.selectedPayments}).then(e=>{this.selectedPayments.forEach(a=>{let c=this.payments.findIndex(o=>o.id===a.id);this.payments.splice(c,1)}),t.showNotification({type:"success",message:d.tc("payments.deleted_message",2)}),s(e)}).catch(e=>{i(e),n(e)})})},setSelectAllState(t){this.selectAllField=t},selectPayment(t){this.selectedPayments=t,this.selectedPayments.length===this.payments.length?this.selectAllField=!0:this.selectAllField=!1},selectAllPayments(){if(this.selectedPayments.length===this.payments.length)this.selectedPayments=[],this.selectAllField=!1;else{let t=this.payments.map(s=>s.id);this.selectedPayments=t,this.selectAllField=!0}},selectNote(t){this.selectedNote=null,this.selectedNote=t},resetSelectedNote(t){this.selectedNote=null},searchPayment(t){return new Promise((s,n)=>{m.get("/api/v1/payments",{params:t}).then(e=>{this.payments=e.data,s(e)}).catch(e=>{i(e),n(e)})})},previewPayment(t){return new Promise((s,n)=>{m.get(`/api/v1/payments/${t.id}/send/preview`,{params:t}).then(e=>{s(e)}).catch(e=>{i(e),n(e)})})},sendEmail(t){return new Promise((s,n)=>{m.post(`/api/v1/payments/${t.id}/send`,t).then(e=>{y().showNotification({type:"success",message:d.t("payments.send_payment_successfully")}),s(e)}).catch(e=>{i(e),n(e)})})},getNextNumber(t,s=!1){return new Promise((n,e)=>{m.get("/api/v1/next-number?key=payment",{params:t}).then(a=>{s&&(this.currentPayment.payment_number=a.data.nextNumber),n(a)}).catch(a=>{i(a),e(a)})})},resetCurrentPayment(){this.currentPayment={...p}},fetchPaymentModes(t){return new Promise((s,n)=>{m.get("/api/v1/payment-methods",{params:t}).then(e=>{this.paymentModes=e.data.data,s(e)}).catch(e=>{i(e),n(e)})})},fetchPaymentMode(t){return new Promise((s,n)=>{m.get(`/api/v1/payment-methods/${t}`).then(e=>{this.currentPaymentMode=e.data.data,s(e)}).catch(e=>{i(e),n(e)})})},addPaymentMode(t){const s=y();return new Promise((n,e)=>{m.post("/api/v1/payment-methods",t).then(a=>{this.paymentModes.push(a.data.data),s.showNotification({type:"success",message:d.t("settings.payment_modes.payment_mode_added")}),n(a)}).catch(a=>{i(a),e(a)})})},updatePaymentMode(t){const s=y();return new Promise((n,e)=>{m.put(`/api/v1/payment-methods/${t.id}`,t).then(a=>{if(a.data){let c=this.paymentModes.findIndex(o=>o.id===a.data.data.id);this.paymentModes[c]=t.paymentModes,s.showNotification({type:"success",message:d.t("settings.payment_modes.payment_mode_updated")})}n(a)}).catch(a=>{i(a),e(a)})})},deletePaymentMode(t){const s=y();return new Promise((n,e)=>{m.delete(`/api/v1/payment-methods/${t}`).then(a=>{let c=this.paymentModes.findIndex(o=>o.id===t);this.paymentModes.splice(c,1),a.data.success&&s.showNotification({type:"success",message:d.t("settings.payment_modes.deleted_message")}),n(a)}).catch(a=>{i(a),e(a)})})}}})()};export{v as u};
