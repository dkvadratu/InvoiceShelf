import{a6 as T,s as h,a3 as g,G as A,u as J,ar as K,at as O,N as R,v as X,e as E,I as H,j as b,f as $,g as B,J as Q,i as W,P as Y,k as Z,r as v,K as ee,o as te,w as p,b as _,m as ae,a as c,l as o,q as S,t as M,M as oe}from"./main-DlOnIu1m.js";import{u as ne}from"./payment-CkHnINqs.js";const se=(C=!1)=>{const d=C?window.pinia.defineStore:T,{global:w}=window.i18n;return d({id:"notes",state:()=>({notes:[],currentNote:{id:null,type:"",name:"",notes:""}}),getters:{isEdit:e=>!!e.currentNote.id},actions:{resetCurrentNote(){this.currentNote={type:"",name:"",notes:""}},fetchNotes(e){return new Promise((u,l)=>{h.get("/api/v1/notes",{params:e}).then(t=>{this.notes=t.data.data,u(t)}).catch(t=>{g(t),l(t)})})},fetchNote(e){return new Promise((u,l)=>{h.get(`/api/v1/notes/${e}`).then(t=>{this.currentNote=t.data.data,u(t)}).catch(t=>{g(t),l(t)})})},addNote(e){return new Promise((u,l)=>{h.post("/api/v1/notes",e).then(t=>{this.notes.push(t.data),u(t)}).catch(t=>{g(t),l(t)})})},updateNote(e){return new Promise((u,l)=>{h.put(`/api/v1/notes/${e.id}`,e).then(t=>{if(t.data){let n=this.notes.findIndex(s=>s.id===t.data.data.id);this.notes[n]=e.notes}u(t)}).catch(t=>{g(t),l(t)})})},deleteNote(e){return new Promise((u,l)=>{h.delete(`/api/v1/notes/${e}`).then(t=>{let n=this.notes.findIndex(s=>s.id===e);this.notes.splice(n,1),u(t)}).catch(t=>{g(t),l(t)})})}}})()},re={class:"flex justify-between w-full"},ie={class:"px-8 py-8 sm:p-6"},ue={class:"z-0 flex justify-end px-4 py-4 border-t border-solid border-gray-light"},de={__name:"NoteModal",setup(C){const d=A(),w=J(),e=se(),u=K(),l=ne(),t=O(),n=R(),{t:s}=X.useI18n();let f=E(!1);const z=H([{label:s("settings.customization.notes.types.invoice"),value:"Invoice"},{label:s("settings.customization.notes.types.estimate"),value:"Estimate"},{label:s("settings.customization.notes.types.payment"),value:"Payment"}]);let N=E(["customer","customerCustom"]);const x=b(()=>d.active&&d.componentName==="NoteModal"),k=b(()=>({currentNote:{name:{required:$.withMessage(s("validation.required"),B),minLength:$.withMessage(s("validation.name_min_length",{count:3}),Q(3))},notes:{required:$.withMessage(s("validation.required"),B)},type:{required:$.withMessage(s("validation.required"),B)}}})),r=W(k,b(()=>e));Y(()=>e.currentNote.type,a=>{V()}),Z(()=>{n.name==="estimates.create"?e.currentNote.type="Estimate":n.name==="invoices.create"||n.name==="recurring-invoices.create"?e.currentNote.type="Invoice":e.currentNote.type="Payment"});function V(){N.value=["customer","customerCustom"],e.currentNote.type=="Invoice"&&N.value.push("invoice","invoiceCustom"),e.currentNote.type=="Estimate"&&N.value.push("estimate","estimateCustom"),e.currentNote.type=="Payment"&&N.value.push("payment","paymentCustom")}async function D(){if(r.value.currentNote.$touch(),r.value.currentNote.$invalid)return!0;if(f.value=!0,e.isEdit){let a={id:e.currentNote.id,...e.currentNote};await e.updateNote(a).then(i=>{f.value=!1,i.data&&(w.showNotification({type:"success",message:s("settings.customization.notes.note_updated")}),d.refreshData&&d.refreshData(),y())}).catch(i=>{f.value=!1})}else await e.addNote(e.currentNote).then(a=>{f.value=!1,a.data&&(w.showNotification({type:"success",message:s("settings.customization.notes.note_added")}),(n.name==="invoices.create"&&a.data.data.type==="Invoice"||n.name==="invoices.edit"&&a.data.data.type==="Invoice")&&u.selectNote(a.data.data),(n.name==="estimates.create"&&a.data.data.type==="Estimate"||n.name==="estimates.edit"&&a.data.data.type==="Estimate")&&t.selectNote(a.data.data),(n.name==="payments.create"&&a.data.data.type==="Payment"||n.name==="payments.edit"&&a.data.data.type==="Payment")&&l.selectNote(a.data.data)),d.refreshData&&d.refreshData(),y()}).catch(a=>{f.value=!1})}function y(){d.closeModal(),setTimeout(()=>{e.resetCurrentNote(),r.value.$reset()},300)}return(a,i)=>{const P=v("BaseIcon"),G=v("BaseInput"),I=v("BaseInputGroup"),j=v("BaseMultiselect"),U=v("BaseCustomInput"),F=v("BaseInputGrid"),q=v("BaseButton"),L=v("BaseModal");return te(),ee(L,{show:x.value,onClose:y,onOpen:V},{header:p(()=>[_("div",re,[S(M(o(d).title)+" ",1),c(P,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:p(()=>[_("form",{action:"",onSubmit:ae(D,["prevent"])},[_("div",ie,[c(F,{layout:"one-column"},{default:p(()=>[c(I,{label:a.$t("settings.customization.notes.name"),variant:"vertical",error:o(r).currentNote.name.$error&&o(r).currentNote.name.$errors[0].$message,required:""},{default:p(()=>[c(G,{modelValue:o(e).currentNote.name,"onUpdate:modelValue":i[0]||(i[0]=m=>o(e).currentNote.name=m),invalid:o(r).currentNote.name.$error,type:"text",onInput:i[1]||(i[1]=m=>o(r).currentNote.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),c(I,{label:a.$t("settings.customization.notes.type"),error:o(r).currentNote.type.$error&&o(r).currentNote.type.$errors[0].$message,required:""},{default:p(()=>[c(j,{modelValue:o(e).currentNote.type,"onUpdate:modelValue":i[2]||(i[2]=m=>o(e).currentNote.type=m),options:z,"value-prop":"value",class:"mt-2"},null,8,["modelValue","options"])]),_:1},8,["label","error"]),c(I,{label:a.$t("settings.customization.notes.notes"),error:o(r).currentNote.notes.$error&&o(r).currentNote.notes.$errors[0].$message,required:""},{default:p(()=>[c(U,{modelValue:o(e).currentNote.notes,"onUpdate:modelValue":i[3]||(i[3]=m=>o(e).currentNote.notes=m),invalid:o(r).currentNote.notes.$error,fields:o(N),onInput:i[4]||(i[4]=m=>o(r).currentNote.notes.$touch())},null,8,["modelValue","invalid","fields"])]),_:1},8,["label","error"])]),_:1})]),_("div",ue,[c(q,{class:"mr-2",variant:"primary-outline",type:"button",onClick:y},{default:p(()=>[S(M(a.$t("general.cancel")),1)]),_:1}),c(q,{loading:o(f),disabled:o(f),variant:"primary",type:"submit"},{left:p(m=>[c(P,{name:"SaveIcon",class:oe(m.class)},null,8,["class"])]),default:p(()=>[S(" "+M(o(e).isEdit?a.$t("general.update"):a.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)]),_:1},8,["show"])}}};export{de as _,se as u};
