import{F as x,H as A,v as L,e as k,I as Z,j as f,P as F,i as H,c as K,a as r,w as d,m as M,r as m,f as p,g as _,o as C,b as h,l as e,q as D,t as U,M as O,K as J,L as Q}from"./main-CAtQQnL-.js";const ee={__name:"PreferencesSetting",setup(R){const b=x(),s=A(),{t:c,tm:W}=L.useI18n();let v=k(!1),y=k(!1),i=k(!1);const n=Z({...b.selectedCompanySettings});f(()=>s.config.retrospective_edits.map(t=>(t.title=c(t.key),t)));const z=f(()=>s.config.fiscal_years.map(t=>Object.assign({},t,{key:c(t.key)})));F(()=>n.carbon_date_format,t=>{if(t){const a=s.dateFormats.find(u=>u.carbon_format_value===t);n.moment_date_format=a.moment_format_value}}),F(()=>n.carbon_time_format,t=>{if(t){const a=s.timeFormats.find(u=>u.carbon_format_value===t);n.moment_time_format=a.moment_format_value}});const q=f({get:()=>n.invoice_use_time==="YES",set:async t=>{const a=t?"YES":"NO";n.invoice_use_time=a}}),S=f({get:()=>n.discount_per_item==="YES",set:async t=>{const a=t?"YES":"NO";let u={settings:{discount_per_item:a}};n.discount_per_item=a,await b.updateCompanySettings({data:u,message:"general.setting_updated"})}}),$=f({get:()=>n.automatically_expire_public_links==="YES",set:async t=>{const a=t?"YES":"NO";n.automatically_expire_public_links=a}}),E=f(()=>({currency:{required:p.withMessage(c("validation.required"),_)},language:{required:p.withMessage(c("validation.required"),_)},carbon_date_format:{required:p.withMessage(c("validation.required"),_)},moment_date_format:{required:p.withMessage(c("validation.required"),_)},carbon_time_format:{required:p.withMessage(c("validation.required"),_)},moment_time_format:{required:p.withMessage(c("validation.required"),_)},time_zone:{required:p.withMessage(c("validation.required"),_)},fiscal_year:{required:p.withMessage(c("validation.required"),_)},invoice_use_time:{required:p.withMessage(c("validation.required"),_)}})),l=H(E,f(()=>n));N();async function N(){i.value=!0,Promise.all([s.fetchCurrencies(),s.fetchDateFormats(),s.fetchTimeFormats(),s.fetchTimeZones()]).then(([t])=>{i.value=!1})}async function Y(){if(l.value.$touch(),l.value.$invalid)return;let t={settings:{...n}};v.value=!0,delete t.settings.link_expiry_days,await b.updateCompanySettings({data:t,message:"settings.preferences.updated_message"}),v.value=!1}async function P(){y.value=!0,await b.updateCompanySettings({data:{settings:{link_expiry_days:n.link_expiry_days,automatically_expire_public_links:n.automatically_expire_public_links}},message:"settings.preferences.updated_message"}),y.value=!1}return(t,a)=>{const u=m("BaseMultiselect"),g=m("BaseInputGroup"),j=m("BaseInputGrid"),V=m("BaseSwitchSection"),w=m("BaseIcon"),B=m("BaseButton"),I=m("BaseDivider"),G=m("BaseInput"),T=m("BaseSettingCard");return C(),K("form",{action:"",class:"relative",onSubmit:M(Y,["prevent"])},[r(T,{title:t.$t("settings.menu_title.preferences"),description:t.$t("settings.preferences.general_settings")},{default:d(()=>[r(j,{class:"mt-5"},{default:d(()=>[r(g,{"content-loading":e(i),label:t.$t("settings.preferences.currency"),"help-text":t.$t("settings.preferences.company_currency_unchangeable"),error:e(l).currency.$error&&e(l).currency.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:n.currency,"onUpdate:modelValue":a[0]||(a[0]=o=>n.currency=o),"content-loading":e(i),options:e(s).currencies,label:"name","value-prop":"id",searchable:!0,"track-by":"name",invalid:e(l).currency.$error,disabled:"",class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["content-loading","label","help-text","error"]),r(g,{label:t.$t("settings.preferences.default_language"),"content-loading":e(i),error:e(l).language.$error&&e(l).language.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:n.language,"onUpdate:modelValue":a[1]||(a[1]=o=>n.language=o),"content-loading":e(i),options:e(s).config.languages,label:"name","value-prop":"code",class:"w-full","track-by":"name",searchable:!0,invalid:e(l).language.$error},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),r(g,{label:t.$t("settings.preferences.time_zone"),"content-loading":e(i),error:e(l).time_zone.$error&&e(l).time_zone.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:n.time_zone,"onUpdate:modelValue":a[2]||(a[2]=o=>n.time_zone=o),"content-loading":e(i),options:e(s).timeZones,label:"key","value-prop":"value","track-by":"key",searchable:!0,invalid:e(l).time_zone.$error},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),r(g,{label:t.$t("settings.preferences.date_format"),"content-loading":e(i),error:e(l).carbon_date_format.$error&&e(l).carbon_date_format.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:n.carbon_date_format,"onUpdate:modelValue":a[3]||(a[3]=o=>n.carbon_date_format=o),"content-loading":e(i),options:e(s).dateFormats,label:"display_date","value-prop":"carbon_format_value","track-by":"display_date",searchable:!0,invalid:e(l).carbon_date_format.$error,class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),r(g,{"content-loading":e(i),error:e(l).fiscal_year.$error&&e(l).fiscal_year.$errors[0].$message,label:t.$t("settings.preferences.fiscal_year"),required:""},{default:d(()=>[r(u,{modelValue:n.fiscal_year,"onUpdate:modelValue":a[4]||(a[4]=o=>n.fiscal_year=o),"content-loading":e(i),options:z.value,label:"key","value-prop":"value",invalid:e(l).fiscal_year.$error,"track-by":"key",searchable:!0,class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["content-loading","error","label"]),r(g,{label:t.$t("settings.preferences.time_format"),"content-loading":e(i),error:e(l).carbon_time_format.$error&&e(l).carbon_time_format.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:n.carbon_time_format,"onUpdate:modelValue":a[5]||(a[5]=o=>n.carbon_time_format=o),"content-loading":e(i),options:e(s).timeFormats,label:"display_time","value-prop":"carbon_format_value","track-by":"display_time",searchable:!0,invalid:e(l).carbon_time_format.$error,class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"])]),_:1}),r(V,{modelValue:q.value,"onUpdate:modelValue":a[6]||(a[6]=o=>q.value=o),title:t.$t("settings.preferences.invoice_use_time"),description:t.$t("settings.preferences.invoice_use_time_description")},null,8,["modelValue","title","description"]),r(B,{"content-loading":e(i),disabled:e(v),loading:e(v),type:"submit",class:"mt-6"},{left:d(o=>[r(w,{name:"ArrowDownOnSquareIcon",class:O(o.class)},null,8,["class"])]),default:d(()=>[D(" "+U(t.$t("settings.company_info.save")),1)]),_:1},8,["content-loading","disabled","loading"]),r(I,{class:"mt-6 mb-2"}),h("ul",null,[h("form",{onSubmit:M(P,["prevent"])},[r(V,{modelValue:$.value,"onUpdate:modelValue":a[7]||(a[7]=o=>$.value=o),title:t.$t("settings.preferences.expire_public_links"),description:t.$t("settings.preferences.expire_setting_description")},null,8,["modelValue","title","description"]),$.value?(C(),J(g,{key:0,"content-loading":e(i),label:t.$t("settings.preferences.expire_public_links"),class:"mt-2 mb-4"},{default:d(()=>[r(G,{modelValue:n.link_expiry_days,"onUpdate:modelValue":a[8]||(a[8]=o=>n.link_expiry_days=o),disabled:n.automatically_expire_public_links==="NO","content-loading":e(i),type:"number"},null,8,["modelValue","disabled","content-loading"])]),_:1},8,["content-loading","label"])):Q("",!0),r(B,{"content-loading":e(i),disabled:e(y),loading:e(y),type:"submit",class:"mt-6"},{left:d(o=>[r(w,{name:"ArrowDownOnSquareIcon",class:O(o.class)},null,8,["class"])]),default:d(()=>[D(" "+U(t.$t("general.save")),1)]),_:1},8,["content-loading","disabled","loading"])],32),r(I,{class:"mt-6 mb-2"}),r(V,{modelValue:S.value,"onUpdate:modelValue":a[9]||(a[9]=o=>S.value=o),title:t.$t("settings.preferences.discount_per_item"),description:t.$t("settings.preferences.discount_setting_description")},null,8,["modelValue","title","description"])])]),_:1},8,["title","description"])],32)}}};export{ee as default};
